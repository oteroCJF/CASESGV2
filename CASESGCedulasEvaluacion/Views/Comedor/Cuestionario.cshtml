@model CedulasEvaluacion.Entities.MCedula.CedulaEvaluacion;
@{
    ViewData["Title"] = "Cédula del Servicio de Comedor General con Folio: " + Model.Folio;
    var f = 0;
    var cf = 0;
    var i = 1;
    decimal totalConceptos = 0;
    decimal totalIVA = 0;
}
<div class="row col-lg-12 d-flex justify-content-end">
    <a href="/comedor/index/@Model.ServicioId@Model.URL" type='button' class='btn-sm btn-warning float-right mr-2 mb-3' data-toggle="tooltip" 
       title="Regresar al listado de cédulas de comedor" data-placement="top">
        <i class="fal fa-arrow-left"></i>
    </a>
</div>
<div class="row col-lg-12">
    <div class="row col-lg-12">
        <div class="col-lg-12">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <a class="nav-link active" id="home-tab" data-toggle="tab" href="#evaluacion" role="tab" aria-controls="home" aria-selected="true">Evaluación del Servicio</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link" id="profile-tab" data-toggle="tab" href="#facturacion" role="tab" aria-controls="profile" aria-selected="false">Facturación</a>
                </li>
            </ul>
            <div class="tab-content" id="myTabContent">
                <!-- Pestaña de Evaluación -->
                <div class="tab-pane fade mt-3 ml-3 show active" id="evaluacion" role="tabpanel" aria-labelledby="home-tab">
                    <h4>Evaluación del Servicio</h4>
                    <div class="row col-lg-12 mt-4 mb-3">
                        <table class="table">
                            <tr>
                                <td data-toggle="tooltip" title="Folio de evaluación asignado por el sistema" data-placement="top" style="font-family: Tahoma; font-size: 13.5px; letter-spacing: 0.8px;"><strong>Folio: </strong> @Model.Folio</td>
                                <td data-toggle="tooltip" title="Año de evaluación del servicio" data-placement="top"><strong>Año: </strong>@Model.Anio</td>
                                <td data-toggle="tooltip" title="Mes evaluado" data-placement="top"><strong>Mes: </strong>@Model.Mes</td>
                                <td data-toggle="tooltip" title="Administración/Inmueble evaluado" data-placement="top"><strong>Inmueble: </strong>@Model.inmuebles.Nombre</td>
                                <td data-toggle="tooltip" title="Servicio Evaluado" data-placement="top"><strong>Servicio Evaluado: </strong>@Model.TipoServicio</td>
                                <td data-toggle="tooltip" title="Estatus de la cédula del servicio de comedor general" data-placement="top"><strong>Estatus: </strong>@Model.Estatus</td>
                            </tr>
                            <tr>
                                <td colspan="2" id="periodo" data-toggle="tooltip" title='Representa la semana del mes "@Model.Mes" del comedor "@Model.inmuebles.Nombre"' data-placement="top">
                                    <strong>Periodo de Evaluación: </strong> @Model.FechaInicial.ToString("dd") de @Model.FechaInicial.ToString("MMMM", @System.Globalization.CultureInfo.CreateSpecificCulture("es"))
                                    del @Model.FechaInicial.ToString("yyyy") al @Model.FechaFinal.ToString("dd") de @Model.FechaFinal.ToString("MMMM", @System.Globalization.CultureInfo.CreateSpecificCulture("es"))
                                    del @Model.FechaFinal.ToString("yyyy")
                                </td>
                                <td id="total_facturas" data-toggle="tooltip" title='Cantidad de facturas asignadas a el mes de "@Model.Mes" del inmueble "@Model.inmuebles.Nombre"' data-placement="top">
                                    <strong>Facturas asignadas: </strong> @Model.facturas.Count
                                </td>
                                <td id="monto_facturas" data-toggle="tooltip" title="Monto total de las facturas capturadas en este folio" data-placement="top">
                                    <strong>Monto Total IVA Incluido: </strong>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.TotalMontoFactura)
                                </td>
                                <td colspan="1"></td>
                            </tr>
                        </table>
                    </div>
                    <div class="card">
                        <div class="card-header bg-joke text-white">
                            <h5 class="mt-2">Evaluación de la cédula</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-lg-12">
                                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                                        @foreach (var pr in Model.preguntas)
                                        {
                                            if (pr.NoPreguntaUsuario == 1)
                                            {
                                                <li class="nav-item" role="presentation">
                                                    <a class="nav-link active" id="home-tab" data-toggle="tab" href="#pregunta_@pr.NoPreguntaUsuario" role="tab" aria-controls="home" aria-selected="true">Pregunta @pr.NoPreguntaUsuario</a>
                                                </li>
                                            }
                                            else
                                            {
                                                <li class="nav-item" role="presentation">
                                                    <a class="nav-link" id="profile-tab" data-toggle="tab" href="#pregunta_@pr.NoPreguntaUsuario" role="tab" aria-controls="profile" aria-selected="false">Pregunta @pr.NoPreguntaUsuario</a>
                                                </li>
                                            }
                                        }
                                        <li class="nav-item" role="presentation">
                                            <a class="nav-link" id="contact-tab" data-toggle="tab" href="#entregables" role="tab" aria-controls="contact" aria-selected="false">Entregables</a>
                                        </li>
                                    </ul>
                                    <div class="tab-content" id="myTabContent">
                                        @foreach (var pr in Model.preguntas)
                                        {
                                            if (pr.NoPreguntaUsuario == 1)
                                            {
                                                <div class="tab-pane fade mt-2 ml-3 show active" id="pregunta_@pr.NoPreguntaUsuario" role="tabpanel" aria-labelledby="home-tab">
                                                    <p class="text-black h5">
                                                        @pr.NoPreguntaUsuario.- @(pr.NoPregunta == 22 ? pr.Pregunta.Replace("comedor general",@Model.TipoServicio) : pr.Pregunta)
                                                        <a href="#" class="text-primary ml-2 btnAyuda" data-toggle="tooltip" title="Ayuda" data-placement="top" data-ayuda="@pr.Ayuda">
                                                            <i class="fa-solid fa-circle-question"></i>
                                                        </a>
                                                    </p>
                                                    @if (!pr.Cierre) //Si la pregunta no es cierre, aplicamos las opciones directamente
                                                    {
                                                        <div class="icheck-success d-inline">
                                                            <input type="radio" name="pregunta_@pr.NoPreguntaUsuario" value="true" id="@String.Concat("radioSuccess", @i)" class="pregunta" data-pregunta="@pr.NoPregunta" 
                                                                   data-pusuario="@pr.NoPreguntaUsuario">
                                                            <label for="@String.Concat("radioSuccess", @i)">Si</label>
                                                        </div>
                                                        i++;
                                                        <div class="icheck-success d-inline ml-3">
                                                            <input type="radio" name="pregunta_@pr.NoPreguntaUsuario" value="false" id="@String.Concat("radioSuccess", @i)" class="pregunta" data-pregunta="@pr.NoPregunta" 
                                                                   data-pusuario="@pr.NoPreguntaUsuario">
                                                            <label for="@String.Concat("radioSuccess", @i)">No</label>
                                                        </div>
                                                        i++;
                                                        @if (pr.NoAplica)
                                                        {
                                                            <div class="icheck-success d-inline ml-3">
                                                                <input type="radio" name="pregunta_@pr.NoPreguntaUsuario" value="N/A" id="@String.Concat("radioSuccess", @i)" class="pregunta" data-pregunta="@pr.NoPregunta" 
                                                                       data-pusuario="@pr.NoPreguntaUsuario">
                                                                <label for="@String.Concat("radioSuccess", @i)">N/A</label>
                                                            </div>
                                                            i++;
                                                        }
                                                        
                                                        @if (pr.NoEntrego)
                                                        {
                                                            <div class="icheck-success d-inline ml-3">
                                                                <input type="radio" name="pregunta_@pr.NoPreguntaUsuario" value="N/E" id="@String.Concat("radioSuccess", @i)" class="pregunta" data-pregunta="@pr.NoPregunta" 
                                                                       data-pusuario="@pr.NoPreguntaUsuario">
                                                                <label for="@String.Concat("radioSuccess", @i)">No Entregaron</label>
                                                            </div>
                                                            i++;
                                                        }

                                                        @if (pr.Incidencias)
                                                        {
                                                            <div class="row col-lg-12 mt-3 cIncidencias" id="divIncidencias_@pr.NoPreguntaUsuario">
                                                                <button type='button' class='btn btn-primary mr-2 addIncidencias' data-pregunta="@pr.NoPregunta" data-pusuario="@pr.NoPreguntaUsuario">
                                                                    Capturar Incidencia
                                                                </button>
                                                                <button type='button' class='btn btn-primary viewIncidencias' data-pregunta="@pr.NoPregunta" data-pusuario="@pr.NoPreguntaUsuario">
                                                                    Consultar Incidencias
                                                                </button>
                                                            </div>
                                                        }
                                                        else if (pr.Fechas)
                                                        {
                                                            <div class="form-row col-lg-12 mt-3 cIncidencias" id="divIncidencias_@pr.NoPreguntaUsuario">
                                                                <div class="form-row">
                                                                    <div class="col col-lg-2">
                                                                        <label for="fechaCierre">Fecha Programada</label>
                                                                        <input type="date" id="fechaProgramada_@pr.NoPreguntaUsuario" class="form-control">
                                                                    </div>
                                                                    <div class="col-lg-2">
                                                                        <label for="fechaCierre">Fecha Entrega</label>
                                                                        <input type="date" id="fechaEntrega_@pr.NoPreguntaUsuario" class="form-control">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        }
                                                    } 
                                                    else if (pr.Cierre)
                                                    {
                                                        <div class="form-group">
                                                            <label for="fechaCierre">Fecha de Cierre</label>
                                                            <input type="date" name="pregunta_@pr.Id" id="fechaCierre" class="form-control col-lg-2 pregunta_@pr.Id">
                                                        </div>
                                                    }
                                                </div>
                                            }
                                            else
                                            {
                                                <div class="tab-pane fade mt-2 ml-3" id="pregunta_@pr.NoPreguntaUsuario" role="tabpanel" aria-labelledby="profile-tab">
                                                    <p class="text-black h5">
                                                        @pr.NoPreguntaUsuario.- @(pr.NoPregunta == 22 ? pr.Pregunta.Replace("comedor general",System.Globalization.CultureInfo.CurrentCulture.TextInfo.ToLower(@Model.TipoServicio)) : pr.Pregunta)
                                                        <a href="#" class="text-primary ml-2 btnAyuda" data-toggle="tooltip" title="Ayuda" data-placement="top" data-ayuda="@pr.Ayuda">
                                                            <i class="fa-solid fa-circle-question"></i>
                                                        </a>
                                                    </p>
                                                    <div class="icheck-success d-inline">
                                                        <input type="radio" name="pregunta_@pr.NoPreguntaUsuario" value="true" id="@String.Concat("radioSuccess", @i)" class="pregunta" data-pregunta="@pr.NoPregunta" 
                                                               data-pusuario="@pr.NoPreguntaUsuario">
                                                        <label for="@String.Concat("radioSuccess", @i)">Si</label>
                                                    </div>
                                                    @{i++; }
                                                    <div class="icheck-success d-inline ml-3">
                                                        <input type="radio" name="pregunta_@pr.NoPreguntaUsuario" value="false" id="@String.Concat("radioSuccess",@i)" class="pregunta" data-pregunta="@pr.NoPregunta" 
                                                               data-pusuario="@pr.NoPreguntaUsuario">
                                                        <label for="@String.Concat("radioSuccess",@i)">No</label>
                                                    </div>
                                                    @{i++; }
                                                    @if (pr.NoAplica)
                                                    {
                                                        <div class="icheck-success d-inline ml-3">
                                                            <input type="radio" name="pregunta_@pr.NoPreguntaUsuario" value="N/A" id="@String.Concat("radioSuccess",@i)" class="pregunta" data-pregunta="@pr.NoPregunta" 
                                                                   data-pusuario="@pr.NoPreguntaUsuario">
                                                            <label for="@String.Concat("radioSuccess",@i)">N/A</label>
                                                        </div>
                                                        i++;
                                                    }

                                                    @if (pr.NoRealizo)
                                                    {
                                                        <div class="icheck-success d-inline ml-3">
                                                            <input type="radio" name="pregunta_@pr.NoPreguntaUsuario" value="N/R" id="@String.Concat("radioSuccess",@i)" class="pregunta" data-pregunta="@pr.NoPregunta" 
                                                                   data-pusuario="@pr.NoPreguntaUsuario">
                                                            <label for="@String.Concat("radioSuccess",@i)">No se realizó</label>
                                                        </div>
                                                        i++;
                                                    }

                                                    @if (pr.NoEntrego)
                                                    {
                                                        <div class="icheck-success d-inline ml-3">
                                                            <input type="radio" name="pregunta_@pr.NoPreguntaUsuario" value="N/E" id="@String.Concat("radioSuccess", @i)" class="pregunta" data-pregunta="@pr.NoPregunta" 
                                                                data-pusuario="@pr.NoPreguntaUsuario">
                                                            <label for="@String.Concat("radioSuccess", @i)">No Entregaron</label>
                                                        </div>
                                                        i++;
                                                    }

                                                    @if (pr.Incidencias)
                                                    {
                                                        <div class="row col-lg-12 mt-3 cIncidencias" id="divIncidencias_@pr.NoPreguntaUsuario">
                                                            <button type='button' class='btn btn-primary mr-2 addIncidencias' data-pregunta="@pr.NoPregunta" data-pusuario="@pr.NoPreguntaUsuario">
                                                                Capturar Incidencia
                                                            </button>
                                                            <button type='button' class='btn btn-primary viewIncidencias' data-pregunta="@pr.NoPregunta" data-pusuario="@pr.NoPreguntaUsuario">
                                                                Consultar Incidencias
                                                            </button>
                                                        </div>
                                                    }
                                                    else if (pr.Fechas)
                                                    {
                                                        <div class="form-row col-lg-12 mt-3 cIncidencias" id="divIncidencias_@pr.NoPreguntaUsuario">
                                                            <div class="form-row">
                                                                <div class="col col-lg-2">
                                                                    <label for="fechaCierre">Fecha Programada</label>
                                                                    <input type="date" id="fechaProgramada_@pr.NoPreguntaUsuario" class="form-control">
                                                                </div>
                                                                <div class="col-lg-2">
                                                                    <label for="fechaCierre">Último Día</label>
                                                                    <input type="date" id="fechaEntrega_@pr.NoPreguntaUsuario" class="form-control">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    }
                                                </div>
                                            }
                                        }
                                        @* Entregables *@
                                        <div class="tab-pane fade mt-2 ml-3" id="entregables" role="tabpanel" aria-labelledby="contact-tab">
                                            <div class="col-lg-12 mt-3">
                                                <h3>Adjuntar Entregables</h3>
                                                Favor de Adjuntar la Factura, el Acta Entrega - Recepción y la Validación del SAT.
                                                <a href="#" type='button' class='btn-sm btn-success mr-2 float-right btn_addFile'><i class="fas fa-plus"></i></a>
                                            </div>
                                            <div class="row col-lg-12 mt-3">
                                                <table class="table" id="tblEntregables">
                                                    <thead>
                                                        <tr>
                                                            <th>Entregable</th>
                                                            <th>Archivo</th>
                                                            <th>Fecha de Carga</th>
                                                            <th>Acciones</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="tEntregables"></tbody>
                                                </table>
                                            </div>
                                        </div>
                                        @* Fin de Entregables *@
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class=" col-lg-12">
                                <button type="button" class="btn btn-primary float-right ml-3 btn_enviar">Enviar a DAS</button>
                                <button type="button" class="btn btn-success float-right btn_guardar">Guardar Cédula</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Fin de la Pestaña de Evaluación -->
                <!-- Pestaña de Facturación -->
                <div class="tab-pane fade mt-2 ml-3" id="facturacion" role="tabpanel" aria-labelledby="profile-tab">
                    <div class="col-lg-12 h3 mt-4">
                        Facturación del Servicio
                    </div>
                    <div class="row col-lg-12 d-flex justify-content-end">
                        <button class='btn btn-sm btn-primary ml-2 mb-3' data-toggle="tooltip" title="Agregar Facturas" data-placement="top" id="add_facturas">
                            <i class="fal fa-plus text-white"></i> Agregar Factura
                        </button>
                    </div>
                    <div class="row">
                        <div class="row col-lg-12">
                            <p class="text-justify ml-3">
                                <strong style="color: dodgerblue;">NOTA: </strong>Favor de revisar que los <strong style="color: dodgerblue;"> datos de la cédula </strong> resaltados en color <strong style="color: dodgerblue;">Azul </strong> coincidan con
                                la información de la factura que fue agregada.
                            </p>
                            <div class="col-lg-12 mt-3 ml-2">
                                <table class="table tblIncidencias tablaFacturas" width="100%">
                                     <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>Tipo</th>
                                                <th>Empresa</th>
                                                <th>Folio Fiscal</th>
                                                <th>Número Factura</th>
                                                <th>Subtotal Factura</th>
                                                <th>IVA</th>
                                                <th>Total</th>
                                                <th>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody id="AA">
                                            @foreach (var fac in Model.facturas)
                                            {
                                                f++;
                                                <tr>
                                                    <td>@f</td>
                                                    <td>@fac.Tipo</td>
                                                    <td>@fac.emisor.Nombre</td>
                                                    <td>@fac.timbreFiscal.UUID</td>
                                                    <td>@fac.comprobante.Folio</td>
                                                    <td>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", fac.comprobante.SubTotal)</td>
                                                    <td>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", fac.traslado.Importe)</td>
                                                    <td>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", fac.comprobante.Total)</td>
                                                    <td class="text-center">
                                                        <a href="#" class="viewConceptosF" id="viewConceptos_@fac.Id" data-factura="@fac.Id" data-toggle="tooltip" title="Ver conceptos de la factura" data-placement="top">
                                                            <i class="fas fa-eye text-success"></i>
                                                        </a>
                                                        @if (fac.Tipo.Equals("Factura") && (Model.Estatus.Equals("En Proceso") || Model.Estatus.Equals("Rechazada")))
                                                        {
                                                            <a href="#" class="eliminarFactura ml-2" data-factura="@fac.Id" data-folio="@fac.comprobante.Serie@fac.comprobante.Folio" data-toggle="tooltip" title="Eliminar Factura" data-placement="top">
                                                                <i class="fas fa-times text-danger"></i>
                                                            </a>
                                                        } 
                                                        
                                                        @if (fac.Tipo.Equals("NC") && (Model.Estatus.Equals("Autorizada") || Model.Estatus.Equals("Trámite Rechazado")))
                                                        {
                                                            <a href="#" class="eliminarFactura ml-2" data-factura="@fac.Id" data-folio="@fac.comprobante.Serie@fac.comprobante.Folio" data-toggle="tooltip" title="Eliminar Nota de Crédito" data-placement="top">
                                                                <i class="fas fa-times text-danger"></i>
                                                            </a>
                                                        }
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                </table>
                            </div>
                            <div class="col-lg-12 mt-3 ml-2 mb-3">
                                @foreach (var fac in Model.facturas)
                                {
                                    <div class="conceptosFactura" id="conceptoFactura_@fac.Id">
                                        <h3>Conceptos de la Factura con Folio: @fac.comprobante.Folio</h3>
                                        <table id="@fac.comprobante.Folio" style="width: 90%" class="table tableConceptos mt-3 float-right">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>Cantidad</th>
                                                    <th>Unidad</th>
                                                    <th>Descripción</th>
                                                    <th>Precio Unitario</th>
                                                    <th>SubTotal</th>
                                                    <th>IVA</th>
                                                    <th>Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var con in fac.concepto)
                                                {
                                                    if (@fac.Id == con.FacturaId)
                                                    {
                                                        cf++;
                                                        <tr>
                                                            <td>@cf</td>
                                                            <td>@con.Cantidad</td>
                                                            <td>@con.Unidad</td>
                                                            <td>@con.Descripcion</td>
                                                            <td>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", con.ValorUnitario)</td>
                                                            <td>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", con.Importe)</td>
                                                            <td>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", con.IVA)</td>
                                                            <td>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", con.Importe + con.IVA)</td>
                                                        </tr>
                                                        totalConceptos = totalConceptos + con.Importe;
                                                        totalIVA = totalIVA + Convert.ToDecimal(con.IVA.ToString("N2"));  
                                                    }
                                                }
                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                    <th colspan="5">Total:</th>
                                                    <th>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", totalConceptos)</th>
                                                    <th>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", totalIVA)</th>
                                                    <th>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", totalConceptos+totalIVA)</th>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Fin de la Pestaña de Facturación-->
            </div>
        </div>
    </div>
</div>

<!----------------------------------------- Agregar/Modificar una Factura ------------------------------------------------------------->
<div class="modal fade" id="modal-facturas">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white">Agregar/Modificar Factura o Nota de Crédito</h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input class="form-control" id="idFactura" type="hidden" />
                <div class="row col-lg-12 mt-2">
                    <div class="form-group col-lg-3">
                        <div class="form-group">
                            <strong>Periodo de Evaluación: </strong> @Model.FechaInicial.ToString("dd/MM/yyyy") al @Model.FechaFinal.ToString("dd/MM/yyyy")
                        </div>
                    </div>
                    <div class="form-group col-lg-6">
                        <label for="elegirArchivo">Seleccionar Archivo XML: </label>
                        <div class="custom-file">
                            <input type="file" class="custom-file-input file_factura" id="fileFactura" accept=".xml">
                            <label class="custom-file-label" for="customFile">Subir archivo "XML"</label>
                        </div>
                        <div class="col-sm-12 error_customFile">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione el archivo correspondiente
                            </small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-content-end">
                <button type="button" class="btn btn-primary" id="agregarFactura">Guardar</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!--------------------------------------- Fin Agregar/Modificar una Factura ----------------------------------------------------------->
<!------------------------------------------------------------------------------------------------>
@* Modal para la captura de Incidencias *@
<div class="modal fade" id="modal-incidencias">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white">Registrar Incidencia</h4>
                <button type="button" class="close close-incidencias text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="idIncidencia" />
                <input type="hidden" id="pregunta" />
                <input type="hidden" id="pusuario" />
                <div class="row col-lg-12 mb-3" id="divEntregaEnseres">
                    <div class="form-group col-md-12">
                        <p class="text-black h6 font-weight-bold">
                            ¿Cumplió con la entrega de enseres de forma completa?
                        </p>
                        <div class="icheck-success d-inline ml-3">
                            <input type="radio" name="chkEnseres" value="true" id="enseresChk1" class="chkEnseres">
                            <label for="enseresChk1">Entrega completa después de la fecha pactada</label>
                        </div>
                        <div class="icheck-success d-inline ml-3">
                            <input type="radio" name="chkEnseres" value="false" id="enseresChk2" class="chkEnseres">
                            <label for="enseresChk2">No entregó</label>
                        </div>
                    </div>
                    <div class="col-sm-12" id="error_entregaEnseres">
                        <small id="dateHelp" class="text-danger">
                            Capture si entregó en la fecha pactada o no entregó
                        </small>
                    </div>
                </div>
                <div class="row col-lg-12">
                    <div class="form-group col-md-3" id="divHorarioMateriaPrima">
                        <label for="lblServicio">Tipo: </label>
                        <select class="form-control" id="selectEntregaHorarioMateriaPrima">
                            <option value="">Seleccione un incumplimiento</option>
                            <option value="Materia Prima">Materia Prima</option>
                            <option value="Plantilla Mínima">Plantilla Mínima</option>
                            <option value="Identidad">Identidad</option>
                        </select>
                        <div class="col-sm-12" id="error_entregaHorarioMateriaPrima">
                            <small id="dateHelp" class="text-danger">
                                Capture el "Incumplimiento"
                            </small>
                        </div>
                    </div>
                    <div class="form-group col-md-3" id="divFechaProgramada">
                        <label for="lblServicio">Fecha Programada: </label>
                        <input type="date" class="form-control" id="fechaProgramada" />
                        <div class="col-sm-12" id="error_fechaProgramada">
                            <small id="dateHelp" class="text-danger">
                                Capture la "Fecha Programada"
                            </small>
                        </div>
                    </div>
                    <div class="form-group col-md-4" id="divFechaRealizada">
                        <label for="lblServicio">Fecha Realizada: </label>
                        <input type="date" class="form-control" id="fechaRealizada" />
                        <div class="col-sm-12" id="error_fechaRealizada">
                            <small id="dateHelp" class="text-danger">
                                Capture la "Fecha Realizada"
                            </small>
                        </div>
                    </div>
                    <div class="form-group col-md-4" id="divFechaMuestraTestigo">
                        <label for="lblServicio">Fecha de toma de muestra: </label>
                        <input type="date" class="form-control" id="fechaMuestraTestigo" />
                        <div class="col-sm-12" id="error_fechaMuestraTestigo">
                            <small id="dateHelp" class="text-danger">
                                Capture la "Fecha de la Muestra Testigo"
                            </small>
                        </div>
                    </div>
                    <div class="form-group col-md-4" id="divFechaApertura">
                        <label for="fechaSolicitud">Horario de Inicio: </label>
                        <input type="datetime-local" name="meeting-time" id="fechaApertura" class="form-control">
                        <div class="col-sm-12" id="error_fechaApertura">
                            <small id="dateHelp" class="text-danger">
                                Por favor capture el "Horario de Apertura" del servicio
                            </small>
                        </div>
                    </div>
                    <div class="form-group col-md-4" id="divFechaReal">
                        <label for="fechaReal">Horario Real: </label>
                        <input type="datetime-local" name="meeting-time" id="fechaReal" class="form-control">
                        <div class="col-sm-12" id="error_fechaReal">
                            <small id="dateHelp" class="text-danger">
                                Por favor capture el "Horario Real" del servicio
                            </small>
                        </div>
                    </div>
                    <div class="form-group col-md-4" id="divFechaIncidencia">
                        <label for="lblServicio">Fecha de la Incidencia: </label>
                        <input type="date" class="form-control" id="fechaIncidencia" />
                        <div class="col-sm-12" id="error_fechaIncidencia">
                            <small id="dateHelp" class="text-danger">
                                Capture la "Fecha de la Incidencia"
                            </small>
                        </div>
                    </div>
                    <div class="form-group col-md-3" id="divFechaEntrega">
                        <label for="lblServicio">Fecha Entrega: </label>
                        <input type="date" class="form-control" id="fechaEntrega" />
                        <div class="col-sm-12" id="error_fechaEntrega">
                            <small id="dateHelp" class="text-danger">
                                Capture la "Fecha de Entrega"
                            </small>
                        </div>
                    </div>
                    <div class="form-group col-sm-5" id="divMuestrasFuera">
                        <label for="fechaReal">Cantidad de muestras fuera de rango: </label>
                        <div class="col-xs-1 col-xs-offset-2">
                            <div class="input-group number-spinner">
                                <span class="input-group-btn">
                                    <button class="btn btn-default" data-dir="dwn"><span class="fas fa-minus"></span></button>
                                </span>
                                <input type="number" class="form-control text-center muestrasFuera" value="1" max="99">
                                <span class="input-group-btn">
                                    <button class="btn btn-default" data-dir="up"><span class="fas fa-plus"></span></button>
                                </span>
                            </div>
                        </div>
                        <div class="col-sm-12" id="error_muestrasFuera">
                            <small id="dateHelp" class="text-danger">
                                Capture el número de "Muestras fuera de rango"
                            </small>
                        </div>
                    </div>
                </div>
                <div class="row col-lg-12">
                    <div class="row col-lg-12">
                        <div class="form-group col-lg-12" id="divComentarios">
                            <label id="lblComentarios">Observaciones: </label>
                            <textarea id="inciComentarios" class="form-control" style="resize:none;"></textarea>
                            <div class="col-sm-12" id="error_Comentarios">
                                <small id="dateHelp" class="text-danger">
                                    Por favor capture la Comentarios
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="d-flex row col-lg-12 justify-content-center">
                    <div class="col-lg-10">
                        <div id='calendar'></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-content-end">
                <button type="button" class="btn btn-primary" id="guardaIncidencia">Guardar Incidencia</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@*Fin Modal para la captura de Incidencias *@

@* Modal para mostrar las Incidencias *@
<div class="modal fade" id="modal-consultaIncidencias">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white">Lista de Incidencias</h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-12">
                        <table class="table table-responsive-xl" id="tbl_incidencias"></table>
                    </div>
                </div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@*Fin Modal para mostrar las Incidencias *@
<!------------------------------------------------------------------------------------------------>
@* Modal para la captura de Adjuntos *@
<div class="modal fade" id="modal_evidencias">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white">Adjuntar Entregables</h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <input type="hidden" id="file_id" />
                    <div class="form-group col-lg-4">
                        <label for="tipoIncidencia">Tipo de Entregable:</label>
                        <select class="form-control" id="tipo_entregable"></select>
                        <div class="col-sm-12" id="error_tipoEntre">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione el tipo de entregable
                            </small>
                        </div>
                    </div>
                    <div class="form-group col-lg-6">
                        <label for="elegirArchivo">Seleccionar Archivo: </label>
                        <div class="custom-file">
                            <input type="file" class="custom-file-input" id="customFile" accept=".pdf">
                            <label class="custom-file-label" for="customFile">Seleccionar Archivo</label>
                        </div>
                        <div class="col-sm-12" id="error_customFile">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione el archivo correspondiente
                            </small>
                        </div>
                    </div>
                    <div class="form-row col-lg-12 mt-2" id="comentariosEntregable">
                        <div class="form-group mt-2 col-md-12">
                            <label for="fechaCierre">Comentarios:</label><br>
                            <textarea id="comentarios_entregable" class="form-control float-left"></textarea>
                            <div class="col-sm-12" id="error_comentariosEntre">
                                <small id="comentariosHelp" class="text-danger">
                                    Por favor capture los comentarios correspondientes
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-content-end">
                <button type="button" class="btn btn-primary" id="adjuntarArchivo">Adjuntar Entregable</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@*Fin Modal para la captura de Incidencias *@

@* Modal para la ver Adjuntos *@
<div class="modal fade" id="show_pdf">
    <div class="modal-dialog modal-xl-view">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white" id="titlePDF"></h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body-view">
                <table class="table">
                    <tr>
                        <td><strong>Folio: </strong> @Model.Folio</td>
                        <td><strong>Año: </strong>@Model.Anio</td>
                        <td><strong>Mes: </strong>@Model.Mes</td>
                        <td><strong>Inmueble: </strong>@Model.inmuebles.Nombre</td>
                        <td><strong>Estatus: </strong>@Model.Estatus </td>
                    </tr>
                </table>
                <div class="row" id="objectPdf">
                </div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@*Fin Modal para ver Adjuntos*@

<style>
    .swal-wide {
        width: 1440px !important;
    }
</style>

@section Scripts{
    <script>
        $(function () {
            var totalPreguntas = '@Model.RespuestasEncuesta.Count';
            var respuestas = @Html.Raw(Json.Serialize(@Model.RespuestasEncuesta));
            var model = @Html.Raw(Json.Serialize(@Model));

            $('[data-toggle="tooltip"]').tooltip();

            $(".tablaFacturas").DataTable({
                paging: true,
                bLengthChange: false,
                pageLength: 10,
                language: {
                    url: "//cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"
                },
            });

            $(".tableConceptos").DataTable({
                paging: true,
                bLengthChange: false,
                pageLength: 10,
                language: {
                    url: "//cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"
                },
            });

            $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
                var target = $(e.target).attr("href") // activated tab
                localStorage.setItem('activeTab', target);
            });

            if (localStorage.getItem('activeTab')) {
                var idTab = localStorage.getItem('activeTab').replace("#", "");
                $('a[href="#pregunta_1"]').removeClass('active');
                $('a[href="' + localStorage.getItem('activeTab') + '"]').addClass('active');
                $("#pregunta_1").removeClass("show active");
                $("#" + idTab).addClass("show active");
            } else {
                $('#myTab li:first').addClass('active');
            }

            $(".divFechasEntrega").css("display", "none");
            $(".cIncidencias").css("display", "none");
            $(".conceptosFactura").css("display", "none");
            $(".error_customFile").css("display", "none");

            /******************************** Ayuda del Cuestionario de Comedor ****************************************/
                $(".btnAyuda").click(function(){
                    var msg = $(this).data("ayuda");
                    Swal.fire({
                        'customClass': 'swal-wide',
                        'icon': "info",
                        'title': 'Servicio de Comedor General',
                        'confirmButtonText': 'Cerrar',
                        'html': '<p style="text-align: justify">'+msg+'.</p>'
                    });
                });
            /******************************* Fin de Ayuda del Cuestionario de Comedor **********************************/

            /******************************** Propiedades de DateRange Picker ****************************************/
                $('#semanaEvaluacion').daterangepicker({
                    "locale": {
                        "format": "DD/MM/YYYY",
                        "separator": " - ",
                        "applyLabel": "Aplicar",
                        "cancelLabel": "Cancelar",
                        "fromLabel": "From",
                        "toLabel": "al",
                        "customRangeLabel": "Custom",
                        "daysOfWeek": [
                            "D",
                            "L",
                            "M",
                            "M",
                            "J",
                            "V",
                            "S"
                        ],
                        "monthNames": [
                            "Enero",
                            "Febrero",
                            "Marzo",
                            "Abril",
                            "Mayo",
                            "Junio",
                            "Julio",
                            "Agosto",
                            "Septiembre",
                            "Octubre",
                            "Noviembre",
                            "Diciembre"
                        ],
                        "firstDay": 1
                    }
                });
            /****************************** Fin Propiedades de DateRange Picker **************************************/

            /********************************** Agregar/Cambiar Facturas *************************************/
                /*Proceso para editar la cedula*/

                    $(document).on('click', '.eliminarFactura', function () {
                        var id = $(this).data('factura');
                        var folio = $(this).data('folio');

                        Swal.fire({
                            'icon': 'warning',
                            'title': 'Servicio de Comedor General',
                            'html': '<strong>Advertencia:</strong><p>¿Desea eliminar la factura con Folio <strong>' + folio + '</strong>?</p>',
                            'confirmButtonColor': '#3085d6',
                            'cancelButtonColor': '#d33',
                            'confirmButtonText': 'Si, continuar',
                            'cancelButtonText': 'Cancelar',
                            'showCancelButton': true
                        }).then(yes => {
                            if (yes.isConfirmed) {
                                Swal.fire({
                                    'icon': 'warning',
                                    'title': 'Servicio de Comedor General',
                                    'text': 'Escriba la palabra ELIMINAR en mayúsculas para confirmar el borrado de la factura con folio: '+folio,
                                    'confirmButtonColor': '#3085d6',
                                    'cancelButtonColor': '#d33',
                                    'confirmButtonText': 'Si, eliminar',
                                    'cancelButtonText': 'Cancelar',
                                    'showCancelButton': true,
                                    'input': 'text',
                                    'inputPlaceholder': 'Escribe la palabra ELIMINAR'
                                }).then(del => {
                                    if (del.value == 'ELIMINAR' || del.value == 'eliminar') {
                                        axios.delete('/facturas/deleteFactura/' + id).then(del => {
                                            Swal.fire({
                                                'icon': 'success',
                                                'title': 'Servicio de Comedor General',
                                                'html': 'La factura fue eliminada exitósamente.',
                                            }).then(function () {
                                                window.location.reload();
                                            });
                                        })
                                    } else {
                                        Swal.fire({
                                            'icon': 'error',
                                            'title': 'Servicio de Comedor General',
                                            'html': 'La factura no fue eliminada exitósamente, favor de escribir correctamente la palabra <b>ELIMINAR</b>',
                                        });
                                    }
                                });
                            }
                        });
                    });

                    $(".file_factura").change(function (e) {
                        var archivo = e.target.files[0];
                        var fileName = $(this).val().split("\\").pop();
                        var ext = fileName.split('.').pop();
                        if (ext == "xml" || ext == "XML") {
                            $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
                            if ($('.file_factura').hasClass('is-invalid')) {
                                $('.file_factura').removeClass('is-invalid');
                                $('.file_factura').addClass('is-valid');
                                $('.error_customFile').css('display', 'none')
                            } else {
                                $('.file_factura').addClass('is-valid');
                            }
                        } else {
                            Swal.fire({
                                'icon': 'error',
                                'title': 'Servicio de Comedor General',
                                'text': 'El archivo que intenta adjuntar no es válido. Favor de solo seleccionar archivos "Xml"'
                            });

                            $(".custom-file-label").text("Seleccionar Archivo");
                            document.getElementById('customFile').value = '';

                            if ($('.file_factura').hasClass('is-valid')) {
                                $('.file_factura').removeClass('is-valid');
                                $('.file_factura').addClass('is-invalid');
                            }
                            $('.file_factura').addClass('is-invalid');
                            $('.error_customFile').css('display', 'block');
                        }
                    });

                    function validaCamposArchivoXml() {
                        if ($('#tipoFactura').val() == "" && $("#idFactura").val() == "") {
                            $('#tipoFactura').addClass('is-invalid');
                            $('.error_tipoFactura').css('display', 'block');

                            return false;
                        }

                        if ($('.file_factura').val() == "") {
                            $('.file_factura').addClass('is-invalid');
                            $('.error_customFile').css('display', 'block');

                            return false;
                        }
                        return true;
                    }

                    $('#agregarFactura').click(function () {
                        var id = $("#idFactura").val();
                        var tipo = "Factura";

                        var formData = new FormData();
                        var file = document.getElementById('fileFactura').files[0];
                        if (id.length > 0) {
                            id = parseInt(id);
                        } else {
                            id = 0;
                        }

                        formData.append("Id", id);
                        formData.append("ServicioId", model.servicioId);
                        formData.append("TipoServicio", (model.tipoServicio != ""));
                        formData.append("Tipo", tipo);
                        formData.append("CedulaId", model.id);
                        formData.append("Xml", file);
                        formData.append("FechaInicial",@Html.Raw(Json.Serialize(@Model.FechaInicial)));
                        formData.append("FechaFinal",@Html.Raw(Json.Serialize(@Model.FechaFinal)));

                        if (validaCamposArchivoXml() == true) {
                            if (id == "") {
                                axios.post('/facturas/insertaFactura', formData).then(fact => {
                                    if (fact.data == 1) {
                                        Swal.fire({
                                            'icon': "success",
                                            'title': 'Servicio de Comedor General',
                                            'html': 'La factura fue agreagada correctamente.'
                                        }).then(function () {
                                            window.location.reload();
                                        });
                                    } else if (fact.data != 1 && fact.data != -1) {
                                        Swal.fire({
                                            'icon': "error",
                                            'title': 'Servicio de Comedor General',
                                            'html': '<p style="text-align: justify">La factura que intenta adjuntar ya fue agregada previamente en la cédula con los siguientes datos: <br />' +
                                                '<li> <b>Folio: </b>' + fact.data.folio + '</li>' +
                                                '<li> <b>Inmueble: </b>' + fact.data.inmuebles.nombre + '</li></p>'
                                        });
                                    }
                                }).catch(error => {
                                    Swal.fire({
                                        'icon': "error",
                                        'title': 'Servicio de Comedor General',
                                        'html': '<p style="text-align: justitfy;">CASESG no puede adjuntar la factura, Contacte al administrador del Sistema.'
                                    });
                                });
                            } else {
                                axios.post('/facturas/updateFactura', formData).then(fact => {
                                    if (fact.data == 1) {
                                        Swal.fire({
                                            'icon': "success",
                                            'title': 'Servicio de Comedor General',
                                            'html': 'La factura fue actualizada correctamente.'
                                        }).then(function () {
                                            window.location.reload();
                                        });
                                    } else if (fact.data != 1 && fact.data != -1) {
                                        Swal.fire({
                                            'icon': "error",
                                            'title': 'Servicio de Comedor General',
                                            'html': '<p style="text-align: justify">La factura que intenta adjuntar ya fue agregada previamente en la cédula con los siguientes datos: <br />' +
                                                '<li> <b>Folio: </b>' + fact.data.folio + '</li>' +
                                                '<li> <b>Inmueble: </b>' + fact.data.inmuebles.nombre + '</li></p>'
                                        });
                                    }
                                }).catch(error => {
                                    Swal.fire({
                                        'icon': "error",
                                        'title': 'Servicio de Comedor General',
                                        'html': '<p style="text-align: justitfy;">CASESG no puede adjuntar la factura, Contacte al administrador del Sistema.'
                                    });
                                });
                            }
                        }

                        document.getElementById('customFile').value = '';
                        $('#idFactura').val("");
                        $(".custom-file .custom-file-label").text("Subir archivo \"XML\"");
                        $('.file_factura').removeClass('is-valid');
                    });
                /*FIN del proceso para editar la cedula*/

                /*Ver Facturas*/
                    $("#btn_facturas").click(function () {
                        axios.get('/limpieza/getFacturas/' + model.id + '/' + model.servicioId).then(table => {
                            var facturas = table.data;
                            for (var i = 0; i < facturas.length; i++) {
                                table += "<tr>" +
                                        "<td>" + (i + 1) + "</td>" +
                                        "<td>" + facturas[i].tipo + "</td>" +
                                        "<td>" + facturas[i].emisor.nombre + "</td>" +
                                        "<td>" + facturas[i].timbreFiscal.uuid + "</td>" +
                                        "<td>" + (facturas[i].comprobante.serie + "" + facturas[i].comprobante.folio) + "</td>" +
                                        "<td> $" + parseFloat(facturas[i].comprobante.subTotal).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') + "</td>" +
                                        "<td> $" + parseFloat(facturas[i].comprobante.total).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') + "</td>" +
                                    "<td>" +
                                "<a class='view_factura' href='#' data-id='" + i + "'><i class='far fa-list text-success'></i></a>" +
                                "<a class='update_factura' href='#' data-id='" + facturas[i].id + "'><i class='fad fa-pencil text-primary ml-2'></i></a>" +
                                "</td>" +
                                "</tr>";
                            }
                            $("#listaFacturas").html(table);
                            if (facturas.length == 0) {
                                $("#listado_facturas").hide();
                            } else {
                                $("#listado_facturas").show();
                            }
                        });
                        $('#modal-ver-facturas').modal('show');
                    });
                /*Fin de Ver Facturas*/

                /*Agregar Facturas*/
                    $('#add_facturas').click(function () {
                        $("#idFactura").val('');
                        $('#modal-ver-facturas').modal('hide');
                        $('#modal-facturas').modal('show');
                    });
                /*Fin Agregar Facturas*/

                /*Ver/Ocultar Conceptos de Factura*/
                    $('.viewConceptosF').click(function () {
                        let factura = $(this).data('factura');
                        if ($("#conceptoFactura_" + factura).css('display') == 'none')
                        {
                            $("#conceptoFactura_" + factura).css("display", "block");
                        }
                        else
                        {
                            $("#conceptoFactura_" + factura).css("display", "none");
                        }
                    });
                /*Fin Ver/Ocultar Conceptos de Factura*/

                /*Ver/Ocultar Conceptos*/
                     $(".viewConceptosF").click(function () {
                         if ($("#viewConceptos_"+$(this).data('factura')+" > i").hasClass("text-success")) {
                             $("#viewConceptos_" + $(this).data('factura') + " > i").removeClass("text-success");
                             $("#viewConceptos_" + $(this).data('factura') + "> i").addClass("text-danger");
                         } else {
                             $("#viewConceptos_" + $(this).data('factura') +" > i").removeClass("text-danger");
                             $("#viewConceptos_"+$(this).data('factura')+" > i").addClass("text-success");
                        }
                    });
                /*Fin de Ver/Ocultar Conceptos*/


            /******************************* FIN Agregar/Cambiar Facturas **********************************/

            /********************************* Validaciones para las respuestas *******************************/
                $('.pregunta').change(function () {
                    let pregunta = $(this).data('pregunta');
                    let pusuario = $(this).data('pusuario');
                    let respuesta = $('input:radio[name="pregunta_' + pusuario + '"]:checked').val();
                    $("#fechaProgramada_" + pusuario).val('');
                    $("#fechaEntrega_" + pusuario).val('');
                    if (pregunta != 10 && pregunta != 11) {
                        if (respuesta == "false") {
                            $("#divIncidencias_" + pusuario).css("display", "block");
                        }
                        else {
                            axios.get('/comedor/totalIncidencia/' + model.id + '/' + pregunta).then(total => {
                                if (total.data > 0) {
                                    Swal.fire({
                                        'icon': 'warning',
                                        'title': 'Servicio de Comedor General',
                                        'html': '<strong>Advertencia:</strong><p>Tiene incidencias capturadas en esta pregunta, al cambiar la respuesta de "NO" a "SI" ' +
                                            '<strong>se eliminarán todas las incidencias. ¿Desea continuar? </strong></p>',
                                        'confirmButtonColor': '#3085d6',
                                        'cancelButtonColor': '#d33',
                                        'confirmButtonText': 'Si, eliminar',
                                        'cancelButtonText': 'Cancelar',
                                        'showCancelButton': true
                                    }).then(p => {
                                        if (p.isConfirmed) {
                                            $('input:radio[name="pregunta_' + pusuario + '"][value="false"]').prop('checked', true);
                                            $("#divIncidencias_" + pusuario).css("display", "block");
                                            Swal.fire({
                                                'icon': 'warning',
                                                'title': 'Servicio de Comedor General',
                                                'text': 'Escriba la palabra ELIMINAR en mayúsculas para confirmar el cambio de respuesta.',
                                                'confirmButtonColor': '#3085d6',
                                                'cancelButtonColor': '#d33',
                                                'confirmButtonText': 'Si, eliminar todo',
                                                'cancelButtonText': 'Cancelar',
                                                'showCancelButton': true,
                                                'input': 'text',
                                                'inputPlaceholder': 'Escribe la palabra ELIMINAR'
                                            }).then(res => {
                                                if ((res.value).toUpperCase() == 'ELIMINAR') {
                                                    axios.get('/comedor/eliminaIncidencias/' + model.id + '/' + pregunta).then(r => {
                                                        Swal.fire({
                                                            'icon': 'success',
                                                            'title': 'Servicio de Comedor General',
                                                            'text': 'Las incidencias de esta pregunta fueron eliminadas correctamente.',
                                                        }).then(function () {
                                                            $('input:radio[name="pregunta_' + pusuario + '"][value="' + respuesta + '"]').prop('checked', true);
                                                            $("#divIncidencias_" + pusuario).css("display", "none");
                                                            guardaCedula();
                                                        });
                                                    });
                                                } else {
                                                    Swal.fire({
                                                        'icon': 'error',
                                                        'title': 'Servicio de Comedor General',
                                                        'text': 'Debe escribir correctamente la palabra ELIMINAR en mayúsculas.',
                                                    });
                                                    $('input:radio[name="pregunta_' + pusuario + '"][value="false"]').prop('checked', true);
                                                    $("#divIncidencias_" + pusuario).css("display", "block");
                                                }
                                            });
                                        } else {
                                            $('input:radio[name="pregunta_' + pusuario + '"][value="false"]').prop('checked', true);
                                            $("#divIncidencias_" + pusuario).css("display", "block");
                                        }
                                    });
                                }
                            });
                            $("#divIncidencias_" + pusuario).css("display", "none");
                        }
                    } else {
                        if (respuesta == "true") {
                            $("#divIncidencias_" + pusuario).css("display", "block");
                        }
                        else {
                            axios.get('/comedor/totalIncidencia/' + model.id + '/' + pregunta).then(total => {
                                if (total.data > 0) {
                                    Swal.fire({
                                        'icon': 'warning',
                                        'title': 'Servicio de Comedor General',
                                        'html': '<strong>Advertencia:</strong><p>Tiene incidencias capturadas en esta pregunta, al cambiar la respuesta de "NO" a "SI" ' +
                                            '<strong>se eliminarán todas las incidencias. ¿Desea continuar? </strong></p>',
                                        'confirmButtonColor': '#3085d6',
                                        'cancelButtonColor': '#d33',
                                        'confirmButtonText': 'Si, eliminar',
                                        'cancelButtonText': 'Cancelar',
                                        'showCancelButton': true
                                    }).then(p => {
                                        if (p.isConfirmed) {
                                            $('input:radio[name="pregunta_' + pusuario + '"][value="true"]').prop('checked', true);
                                            $("#divIncidencias_" + pusuario).css("display", "block");
                                            Swal.fire({
                                                'icon': 'warning',
                                                'title': 'Servicio de Comedor General',
                                                'text': 'Escriba la palabra ELIMINAR en mayúsculas para confirmar el cambio de respuesta.',
                                                'confirmButtonColor': '#3085d6',
                                                'cancelButtonColor': '#d33',
                                                'confirmButtonText': 'Si, eliminar todo',
                                                'cancelButtonText': 'Cancelar',
                                                'showCancelButton': true,
                                                'input': 'text',
                                                'inputPlaceholder': 'Escribe la palabra ELIMINAR'
                                            }).then(res => {
                                                if ((res.value).toUpperCase() == 'ELIMINAR') {
                                                    axios.get('/comedor/eliminaIncidencias/' + model.id + '/' + pregunta).then(r => {
                                                        Swal.fire({
                                                            'icon': 'success',
                                                            'title': 'Servicio de Comedor General',
                                                            'text': 'Las incidencias de esta pregunta fueron eliminadas correctamente.',
                                                        }).then(function () {
                                                            $('input:radio[name="pregunta_' + pusuario + '"][value="false"]').prop('checked', true);
                                                            guardaCedula();
                                                        });
                                                    });
                                                } else {
                                                    Swal.fire({
                                                        'icon': 'error',
                                                        'title': 'Servicio de Comedor General',
                                                        'text': 'Debe escribir correctamente la palabra ELIMINAR en mayúsculas.',
                                                    });
                                                    $('input:radio[name="pregunta_' + pusuario + '"][value="true"]').prop('checked', true);
                                                    $("#divIncidencias_" + pusuario).css("display", "block");
                                                }
                                            });
                                        } else {
                                            $('input:radio[name="pregunta_' + pusuario + '"][value="true"]').prop('checked', true);
                                            $("#divIncidencias_" + pusuario).css("display", "block");
                                        }
                                    });
                                }
                            });
                            $("#divIncidencias_" + pusuario).css("display", "none");
                        }
                    }
                });
            /********************************* Validaciones para las respuestas *******************************/

            /********************************** Incidencias ************************************************/
                var tiposIncidencias = ["","PresentacionPlatillos", "EntregaResMedBac", "EntregaResAnaMic", "HorariosComedorRegrigerios", "HorarioDesayunoBocadillosEventos",
                    "MateriaPrima", "LimpiezaProfunda", "Fumigacion", "FueraRangoAnaMic", "FueraRangoMedBac", "EnseresTipoA", "EnseresTipoB", "EnseresTipoC", "MuestaTestigo",
                    "LavadoDesinfeccionVerduras", "Descongelamiento", "LavadoDesinfeccionUtensilios", "LimpiezaSalonComedor", "ProgramaLimpieza", "ActividadesProgramadas",
                    "ServicioComedor","EntregaMateriaPrimaIdentidadPlantilla"]
                ocultaControles();

                /*Spinner para el input number*/
                $(document).on('click', '.number-spinner button', function () {
                    var btn = $(this),
                        oldValue = btn.closest('.number-spinner').find('input').val().trim(),
                        newVal = 1;

                    if (btn.attr('data-dir') == 'up' && oldValue <99) {
                        newVal = parseInt(oldValue) + 1;
                    } else {
                        if (oldValue > 1 && oldValue <99) {
                            newVal = parseInt(oldValue) - 1;
                        } else {
                            newVal = 1;
                        }
                    }
                    btn.closest('.number-spinner').find('input').val(newVal);
                });
                /*FIn Spinner para el input number*/

                $(".addIncidencias").click(function () {
                    $('#idIncidencia').val('');
                    $('#pregunta').val('');
                    $('#fechaProgramada').val('');
                    $('#fechaIncidencia').val('');
                    $('#fechaEntrega').val('');
                    $('#fechaApertura').val('');
                    $('#fechaReal').val('');
                    $('.muestrasFuera').val(1);
                    $('#inciComentarios').val('');
                    $('input:radio[name="enseres"]').prop('checked', false);
                    var pregunta = $(this).data('pregunta');
                    var pusuario = $(this).data('pusuario');
                    $("#pregunta").val(pregunta);
                    $("#pusuario").val(pusuario);
                    muestraControles(pregunta);
                    if (model.tipoServicio == "Comedor") {
                        $('#fechaApertura').prop("disabled", (pregunta == 23 ? false: true));
                    }
                    $("#modal-incidencias").modal("show");
                });

                function ocultaControles(){
                    $("#divHorarioMateriaPrima").css("display", "none");
                    $("#divFechaProgramada").css("display", "none");
                    $("#divEntregaEnseres").css("display", "none");
                    $("#divFechaEntrega").css("display", "none");
                    $("#divFechaApertura").css("display", "none");
                    $("#divFechaIncidencia").css("display", "none");
                    $("#divFechaReal").css("display", "none");
                    $("#divFechaRealizada").css("display", "none");
                    $("#divFechaMuestraTestigo").css("display", "none");
                    $("#divMuestrasFuera").css("display", "none");
                    $("#divComentarios").css("display", "none");

                    $("#error_entregaHorarioMateriaPrima").css("display", "none");
                    $("#error_Comentarios").css("display", "none");
                    $("#error_muestrasFuera").css("display", "none");
                    $("#error_fechaProgramada").css("display", "none");
                    $("#error_fechaEntrega").css("display", "none");
                    $("#error_fechaRealizada").css("display", "none");
                    $("#error_fechaApertura").css("display", "none");
                    $("#error_fechaReal").css("display", "none");
                    $("#error_fechaIncidencia").css("display", "none");
                    $("#error_fechaMuestraTestigo").css("display", "none");
                    $("#error_entregaEnseres").css("display", "none");
                }

                function muestraControles(pregunta) {
                    ocultaControles();
                    if (pregunta == 2 || pregunta == 7 || pregunta == 8 || pregunta == 17 || pregunta == 18 || pregunta == 16
                        || pregunta == 19 || pregunta == 20 || pregunta == 21 || pregunta == 22) {
                        $("#divFechaIncidencia").css("display", "block");
                        $("#divFechaIncidencia > label").text("Fecha de la Incidencia:");
                        $("#divComentarios").css("display", "block");
                    } else if (pregunta == 5 || pregunta == 6) {
                        $("#divFechaApertura").css("display", "block");
                        $("#divFechaReal").css("display", "block");
                        $("#divComentarios").css("display", "block");
                    }
                    else if (pregunta == 23) {
                        $("#divHorarioMateriaPrima").css("display", "block");
                        $("#divFechaIncidencia").css("display", "block");
                        $("#divComentarios").css("display", "block");
                    }
                    else if (pregunta == 10 || pregunta == 11) {
                        $("#divFechaIncidencia").css("display", "block");
                        $("#divFechaIncidencia > label").text("Día en que se tomó la muestra:");
                        $("#divMuestrasFuera").css("display", "block");
                        $("#divComentarios").css("display", "block");
                    }
                    else if (pregunta == 12 || pregunta == 13 || pregunta == 14) {
                        $("#divEntregaEnseres").css("display", "block");
                        var entrego = $('input:radio[name="chkEnseres"]:checked').val();
                        if (entrego != undefined) {
                            $("#divFechaProgramada").css("display", "block");
                            $("#divFechaProgramada > label").text("Fecha de realización del inventario:");
                            if (entrego == "true") {
                                $("#divFechaEntrega").css("display", "block");
                                $("#divFechaEntrega > label").text("Fecha de entrega de enseres:");
                            }
                            if (pregunta == 13 || pregunta == 14) {
                                $("#divFechaIncidencia").css("display", "block");
                                $("#divFechaIncidencia > label").text((pregunta == 13 ? "Fecha de notificación:" : "Fecha acordada con la admin. del inmueble: "));
                            }
                            $("#divMuestrasFuera").css("display", "block");
                            $("#divMuestrasFuera > label").text("Cantidad de equipo de cocina y enseres de mesa faltantes:");
                            $("#divComentarios").css("display", "block");
                        }
                    }
                    else if (pregunta == 15) {
                        $("#divFechaMuestraTestigo").css("display", "block");
                        $("#divFechaMuestraTestigo > label").text("Fecha en la que no se tomaron las muestras testigo completas:");
                        $("#divComentarios").css("display", "block");
                    }else if (pregunta == 9) {
                        $("#divFechaRealizada").css("display", "block");
                        $("#divFechaRealizada > label").text("Fecha Realizada:");
                        $("#divFechaProgramada").css("display", "block");
                        $("#divFechaProgramada > label").text("Fecha Programada:");
                        $("#divComentarios").css("display", "block");
                    }
            }

                $(".viewIncidencias").click(function () {
                    let pregunta = $(this).data('pregunta');
                    let pusuario = $(this).data('pusuario');
                    axios.get('/comedor/tablaIncidencias/' + model.id + '/' + pregunta + '/' + pusuario).then(table => {
                        $("#tbl_incidencias").html(table.data);
                    }).catch(error => {
                        Swal.fire({
                            'icon': 'error',
                            'title': 'Servicio de Comedor General',
                            'html': 'Hubo un error al obtener el listado de incidencias. Contacte a su administrador del sistema.'
                        });
                    });
                    $("#modal-consultaIncidencias").modal('show');
                });

                function validaIncidencias(pregunta) {
                    if (pregunta == 2 || pregunta == 7 || pregunta == 8 || pregunta == 17 || pregunta == 18 || pregunta == 16
                        || pregunta == 19 || pregunta == 20 || pregunta == 21 || pregunta == 22 || pregunta == 23) {
                        if ($('#fechaIncidencia').val() != "") {
                            if ($('#fechaIncidencia').val() >= model.fechaInicial.substring(0, 10) && $('#fechaIncidencia').val() <= model.fechaFinal.substring(0, 10)) {
                                if (pregunta == 23 && $("#selectEntregaHorarioMateriaPrima").val() == "") {
                                    Swal.fire({
                                        'icon': 'error',
                                        'title': 'Servicio de Comedor General',
                                        'html': '<p style="text-align: justify">Por favor seleccione el incumplimiento.</p>'
                                    });
                                    $('#selectEntregaHorarioMateriaPrima').addClass('is-invalid');
                                    $('#error_entregaHorarioMateriaPrima').css('display', 'block');
                                    return false;
                                }
                                return true;
                            }
                            Swal.fire({
                                    'icon': 'error',
                                    'title': 'Servicio de Comedor General',
                                    'html': '<p style="text-align: justify">La <strong>Fecha de la incidencia</strong> debe estar dentro del periodo evaluado.'
                                        + '<br><br><strong>Periodo Evaluado: </strong>'+@Html.Raw(Json.Serialize(@Model.FechaInicial.ToString("dd/MM/yyyy")))+' al '+@Html.Raw(Json.Serialize(@Model.FechaFinal.ToString("dd/MM/yyyy")))+'</p>'
                                });
                                return false;
                        }
                        $('#fechaIncidencia').addClass('is-invalid');
                        $('#error_fechaIncidencia').css('display', 'block');
                    }
                    else if (pregunta == 5 || pregunta == 6) {
                        if ($('#fechaApertura').val() != "" && $('#fechaReal').val() != "") {
                            if ($('#fechaApertura').val().substring(0, 10) >= model.fechaInicial.substring(0, 10) &&
                                $('#fechaReal').val().substring(0, 10) <= model.fechaFinal.substring(0, 10)) {
                                if ($('#fechaApertura').val() > $('#fechaReal').val()) {
                                    Swal.fire({
                                    'icon': 'error',
                                    'title': 'Servicio de Comedor General',
                                        'html': '<p style="text-align: justify">El <strong>Horario de Apertura</strong> debe ser menor al <strong>Horario de Real</strong>.</p>'
                                    });
                                    return false;
                                }
                                return true;
                            }
                            Swal.fire({
                                    'icon': 'error',
                                    'title': 'Servicio de Comedor General',
                                    'html': '<p style="text-align: justify">El <strong>Horario de Apertura y Real</strong> deben estar dentro del periodo evaluado.'
                                        + '<br><br><strong>Periodo Evaluado: </strong>' +@Html.Raw(Json.Serialize(@Model.FechaInicial.ToString("dd/MM/yyyy")))+' al '
                                        +@Html.Raw(Json.Serialize(@Model.FechaFinal.ToString("dd/MM/yyyy")))+'.</p>'
                            });
                            return false;
                        }
                        $("#fechaApertura").addClass('is-invalid');
                        $("#fechaReal").addClass('is-invalid');
                        $('#error_fechaApertura').css('display', 'block');
                        $('#error_fechaReal').css('display', 'block');
                        Swal.fire({
                            'icon': 'error',
                            'title': 'Servicio de Comedor General',
                            'html': 'Capture el <strong>Horario Real</strong>.'
                        });
                        Swal.fire({
                            'icon': 'error',
                            'title': 'Servicio de Comedor General',
                            'html': 'Capture la <strong>Fecha real de apertura</strong>.'
                        });
                    }
                    else if (pregunta == 10 || pregunta == 11) {
                        if ($('.muestrasFuera').val() != "" && $('.muestrasFuera').val() != 0) {
                            return true;
                        }
                        $(".muestrasFuera").addClass('is-invalid');
                        $('#error_muestrasFuera').css('display', 'block');
                        Swal.fire({
                            'icon': 'error',
                            'title': 'Servicio de Comedor General',
                            'html': 'Capture el número de muestras fuera de rango, recuerde que el número de muestras debe estar entre <strong> 1 y 99</strong>.'
                        });
                    }
                    else if (pregunta == 12 || pregunta == 13 || pregunta == 14) {
                        return true;
                        if ($('#fechaProgramada').val() != "" && $('#fechaEntrega').val() != "" &&
                            ($('.muestrasFuera').val() != "" && $('.muestrasFuera').val() != 0)) {
                            if ($('#fechaProgramada').val() > $('#fechaEntrega').val()) {
                                Swal.fire({
                                    'icon': 'error',
                                    'title': 'Servicio de Comedor General',
                                    'html': '<p style="text-align: justify">La <strong>Fecha Programada</strong> debe ser menor a la <strong>Fecha de Entrega</strong>.</p>'
                                });
                                return false;
                            }
                            return true;
                        }
                        $("#fechaProgramada").addClass('is-invalid');
                        $("#fechaEntrega").addClass('is-invalid');
                        $(".muestrasFuera").addClass('is-invalid');
                        $('#error_muestrasFuera').css('display', 'block');
                        $('#error_fechaProgramada').css('display', 'block');
                        $('#error_fechaEntrega').css('display', 'block');
                        Swal.fire({
                            'icon': 'error',
                            'title': 'Servicio de Comedor General',
                            'html': 'Capture la <strong>Fecha programada</strong> y la <strong>Fecha de entrega</strong>, de igual forma ' +
                                    'la <strong>Fecha programada</strong> debe ser menor a la <strong>Fecha de entrega</strong>.'
                        });
                    }
                    else if (pregunta == 15) {
                        if ($('#fechaMuestraTestigo').val() != "") {
                            return true;
                        }
                        $("#fechaMuestraTestigo").addClass('is-invalid');
                        $('#error_fechaMuestraTestigo').css('display', 'block');
                        Swal.fire({
                            'icon': 'error',
                            'title': 'Servicio de Comedor General',
                            'html': 'Capture la <strong>Fecha de la muestra testigo</strong>.'
                        });
                    }
                    else if (pregunta == 9) {
                        if ($('#fechaProgramada').val() != "" && $('#fechaRealizada').val() != "") {
                            if ($('#fechaProgramada').val().substring(0, 10) >= model.fechaInicial.substring(0, 10) &&
                                $('#fechaRealizada').val().substring(0, 10) <= model.fechaFinal.substring(0, 10)) {
                                if ($('#fechaProgramada').val() > $('#fechaRealizada').val()) {
                                    Swal.fire({
                                        'icon': 'error',
                                        'title': 'Servicio de Comedor General',
                                        'html': '<p style="text-align: justify">La <strong>Fecha Programada</strong> debe ser menor a la <strong>Fecha Realizada</strong>.</p>'
                                    });
                                    return false;
                                }
                                return true;
                            }
                            Swal.fire({
                                    'icon': 'error',
                                    'title': 'Servicio de Comedor General',
                                    'html': '<p style="text-align: justify">El <strong>Horario de Apertura y Real</strong> deben estar dentro del periodo evaluado.'
                                    + '<br><br><strong>Periodo Evaluado: </strong>' +@Html.Raw(Json.Serialize(@Model.FechaInicial.ToString("dd/MM/yyyy")))+' al ' +@Html.Raw(Json.Serialize(@Model.FechaFinal.ToString("dd/MM/yyyy")))+'.</p>'
                            });
                            return false;
                        }
                        $("#fechaProgramada").addClass('is-invalid');
                        $('#error_fechaProgramada').css('display', 'block');
                        $("#fechaRealizada").addClass('is-invalid');
                        $('#error_fechaRealizada').css('display', 'block');
                        Swal.fire({
                            'icon': 'error',
                            'title': 'Servicio de Comedor General',
                            'html': 'Capture la <strong>Fecha de la muestra testigo</strong>.'
                        });
                    }

                    return false;
                }

                $('#guardaIncidencia').click(function () {
                    let url = "inserta";
                    let msg = "guardó";
                    let id = $('#idIncidencia').val();
                    let tipo = tiposIncidencias[$("#pregunta").val()-1];
                    let pregunta = $('#pregunta').val();
                    let fechaProgramada = '1990-01-01';
                    let fechaEntrega = '1990-01-01';
                    let fechaIncidencia = '1990-01-01';
                    let totalMuestras = 0;
                    let incumplimiento = "";
                    let comentarios = $('#inciComentarios').val();
                    let cumplio = $('input:radio[name="chkEnseres"]:checked').val();

                    if (id != "" && id != null) {
                        id = id;
                        url = "actualiza";
                        msg = "actualizó";
                    } else {
                        id = 0;
                    }

                    if (pregunta == 2 || pregunta == 7 || pregunta == 8 || pregunta == 16 || pregunta == 17 || pregunta == 18
                        || pregunta == 19 || pregunta == 20 || pregunta == 21 || pregunta == 22 || pregunta == 23) {
                        fechaIncidencia = $("#fechaIncidencia").val();
                        if (pregunta == 23) {
                            incumplimiento = $("#selectEntregaHorarioMateriaPrima").val();
                        }
                    }
                    else if (pregunta == 5 || pregunta == 6) {
                        fechaProgramada = $("#fechaApertura").val();
                        fechaEntrega = $("#fechaReal").val();
                    }
                    else if (pregunta == 10 || pregunta == 11) {
                        fechaIncidencia = $("#fechaIncidencia").val();
                        totalMuestras = $(".muestrasFuera").val();
                    }
                    else if (pregunta == 12 || pregunta == 13 || pregunta == 14) {
                        fechaProgramada = $("#fechaProgramada").val();
                        totalMuestras = $(".muestrasFuera").val();
                        if (cumplio == "true") {
                            fechaEntrega = $("#fechaEntrega").val();
                        }

                        if (pregunta == 13 || pregunta == 14) {
                            fechaIncidencia = $("#fechaIncidencia").val();
                        }
                    }
                    else if (pregunta == 15) {
                        fechaIncidencia = $("#fechaMuestraTestigo").val();
                    }
                    else if (pregunta == 9) {
                        fechaProgramada = $("#fechaProgramada").val();
                        fechaEntrega = $("#fechaRealizada").val();
                    }

                    if (validaIncidencias(pregunta)) {
                        axios.post("/valida/comedor/fechaIncidencia", {
                            CedulaComedorId: parseInt(model.id), Tipo: tipo, FechaIncidencia: fechaIncidencia, Incumplimiento: incumplimiento
                        }).then(valida => {
                            if (!valida.data) {
                                axios.post("/comedor/" + url + "/incidencia", {
                                    Id: parseInt(id), CedulaComedorId: parseInt(model.id), Incumplimiento: incumplimiento, Tipo: tipo, FechaProgramada: fechaProgramada, FechaEntrega: fechaEntrega,
                                    FechaIncidencia: fechaIncidencia, TotalMuestras: parseInt(totalMuestras), Comentarios: comentarios, Cumplio: (cumplio == "true")
                                }).then(response => {
                                    if (response.status == 200) {
                                        guardaCedula();
                                        Swal.fire({
                                            'icon': "success",
                                            'title': 'Servicio de Comedor General',
                                            'html': "La incidencia se " + msg + " correctamente."
                                        }).then(function () {
                                            window.location.reload();
                                        });
                                    }
                                }).catch(error => {
                                    Swal.fire({
                                        'icon': "error",
                                        'title': 'Servicio de Comedor General',
                                        'html': "Hubo un error al insertar/actualizar la incidencia. Contacte a su administrador del sistema."
                                    });
                                });
                            } else {
                                Swal.fire({
                                    'icon': "error",
                                    'title': 'Servicio de Comedor General',
                                    'html': "Ya fue capturada una incidencia en el día seleccionado."
                                });
                            }
                        });
                        $('#idIncidencia').val('');
                        $('#pregunta').val('');
                        $('#fechaProgramada').val('');
                        $('#fechaIncidencia').val('');
                        $('#fechaEntrega').val('');
                        $('#fechaApertura').val('');
                        $('#fechaReal').val('');
                        $('.muestrasFuera').val(1);
                        $('#inciComentarios').val('');
                        $("#selectEntregaHorarioMateriaPrima").val('');
                        $("#modal-incidencias").modal("hide");
                    }

                });

                $(document).on("click", ".update_incidencia", function () {
                    $("#modal-consultaIncidencias").modal('hide');
                    $('#idIncidencia').val('');
                    $('#pregunta').val('');
                    $('#fechaProgramada').val('');
                    $('#fechaIncidencia').val('');
                    $('#fechaEntrega').val('');
                    $('#fechaApertura').val('');
                    $('#fechaReal').val('');
                    $('.muestrasFuera').val(1);
                    $('#inciComentarios').val('');
                    $('input:radio[name="chkEnseres"]').prop('checked', false);
                    let pregunta = $(this).data('pregunta');
                    $("#idIncidencia").val($(this).data('id'));
                    $("#pregunta").val(pregunta);
                    if (pregunta == 2 || pregunta == 7 || pregunta == 8  || pregunta == 17 || pregunta == 18 || pregunta == 16
                        || pregunta == 19 || pregunta == 20 || pregunta == 21 || pregunta == 22 || pregunta == 23) {
                        $("#fechaIncidencia").val($(this).data('fechaincidencia'));
                        if (pregunta == 23) {
                            $("#selectEntregaHorarioMateriaPrima").val($(this).data('incumplimiento'));
                        }
                    } else if (pregunta == 5 || pregunta == 6) {
                        $('#fechaApertura').prop("disabled", true);
                        $("#fechaApertura").val($(this).data('fechaprogramada'));
                        $("#fechaReal").val($(this).data('fechaentrega'));
                    } else if (pregunta == 10 || pregunta == 11) {
                        $("#fechaIncidencia").val($(this).data('fechaincidencia'));
                        $(".muestrasFuera").val($(this).data('muestras'));
                    } else if (pregunta == 12 || pregunta == 13 || pregunta == 14) {
                        if ($(this).data('cumplio')) {
                            $('#enseresChk1').prop('checked', true);
                        } else {
                            $('#enseresChk2').prop('checked', true);
                        }
                        $("#fechaEntrega").val($(this).data('fechaentrega'));
                        $("#fechaProgramada").val($(this).data('fechaprogramada'));
                        $("#fechaIncidencia").val($(this).data('fechaincidencia'));
                        $(".muestrasFuera").val($(this).data('muestras'));
                    } else if (pregunta == 15) {
                        $("#fechaMuestraTestigo").val($(this).data('fechaincidencia'));
                    } else if (pregunta == 9) {
                        $("#fechaProgramada").val($(this).data('fechaprogramada'));
                        $("#fechaRealizada").val($(this).data('fechaentrega'));
                    }
                    $("#inciComentarios").val($(this).data('comentarios'));
                    muestraControles(pregunta);
                    $("#modal-incidencias").modal('show');
                });

                $(document).on("click", ".delete_incidencia", function(){
                    var id = $(this).data("id");
                    var pregunta = $(this).data("pregunta");
                    var pusuario = $(this).data("pusuario");

                    Swal.fire({
                            'icon': 'warning',
                            'title': 'Servicio de Comedor General',
                            'html': '¿Está seguro de eliminar la incidencia?',
                            'confirmButtonColor': '#3085d6',
                            'cancelButtonColor': '#d33',
                            'confirmButtonText': 'Si, eliminar',
                            'cancelButtonText': 'Cancelar',
                            'showCancelButton': true
                        }).then(response => {
                            if (response.isConfirmed) {
                                axios.get("/comedor/incidencia/eliminar/"+id).then(response => {
                                    if (response.status == 200) {
                                        Swal.fire({
                                            'icon': 'success',
                                            'title': 'Servicio de Comedor General',
                                            'html': 'La incidencia fue eliminada correctamente de la pregunta ' + pusuario+'.',
                                        }).then(function () {
                                            axios.get('/comedor/tablaIncidencias/' + model.id + '/' + pregunta + '/' + pusuario).then(table => {
                                                $("#tbl_incidencias").html(table.data);
                                            }).catch(error => {
                                                Swal.fire({
                                                    'icon': 'error',
                                                    'title': 'Servicio de Comedor General',
                                                    'html': 'Hubo un error al obtener el listado de incidencias. Contacte a su administrador del sistema.'
                                                });
                                            });
                                        });
                                    }
                                }).catch(error => {
                                    Swal.fire({
                                        'icon': 'error',
                                        'title': 'Servicio de Comedor General',
                                        'html':'No se pudo eliminar la incidencia del servicio de Comedor General. Contacta a tu Administrador.',
                                    });
                                });
                            }
                        });

                });

                $('#fechaIncidencia').change(function () {
                    if ($('#fechaIncidencia').val() == "") {
                        $('#fechaIncidencia').removeClass('is-valid');
                        $('#fechaIncidencia').addClass('is-invalid');
                        $('#error_fechaIncidencia').css('display', 'block');
                    } else {
                        $('#fechaIncidencia').removeClass('is-invalid');
                        $('#fechaIncidencia').addClass('is-valid');
                        $('#error_fechaIncidencia').css('display', 'none');
                    }
                });

                $('#fechaApertura').change(function () {
                    if ($('#fechaApertura').val() == "") {
                        $('#fechaApertura').removeClass('is-valid');
                        $('#fechaApertura').addClass('is-invalid');
                        $('#error_fechaApertura').css('display', 'block');
                    } else {
                        $('#fechaApertura').removeClass('is-invalid');
                        $('#fechaApertura').addClass('is-valid');
                        $('#error_fechaApertura').css('display', 'none');
                    }
                });

                $('#fechaReal').change(function () {
                    var fechaReal = $(this).val();
                    if ($('#fechaReal').val() == "") {
                        $('#fechaReal').removeClass('is-valid');
                        $('#fechaReal').addClass('is-invalid');
                        $('#error_fechaReal').css('display', 'block');
                    } else {
                        if (model.tipoServicio == "Comedor" && $("#pregunta").val() == 5) {
                            $('#fechaApertura').val(fechaReal.substring(0, 10) + "T" + model.horarioComedor.valor);
                        }
                        $('#fechaReal').removeClass('is-invalid');
                        $('#fechaReal').addClass('is-valid');
                        $('#error_fechaReal').css('display', 'none');
                    }
                });

                $('#fechaProgramada').change(function () {
                    if ($('#fechaProgramada').val() == "") {
                        $('#fechaProgramada').removeClass('is-valid');
                        $('#fechaProgramada').addClass('is-invalid');
                        $('#error_fechaProgramada').css('display', 'block');
                    } else {
                        $('#fechaProgramada').removeClass('is-invalid');
                        $('#fechaProgramada').addClass('is-valid');
                        $('#error_fechaProgramada').css('display', 'none');
                    }
                });

                $('#fechaEntrega').change(function () {
                    if ($('#fechaEntrega').val() == "") {
                        $('#fechaEntrega').removeClass('is-valid');
                        $('#fechaEntrega').addClass('is-invalid');
                        $('#error_fechaEntrega').css('display', 'block');
                    } else {
                        $('#fechaEntrega').removeClass('is-invalid');
                        $('#fechaEntrega').addClass('is-valid');
                        $('#error_fechaEntrega').css('display', 'none');
                    }
                });

                $('#fechaMuestraTestigo').change(function () {
                    if ($('#fechaMuestraTestigo').val() == "") {
                        $('#fechaMuestraTestigo').removeClass('is-valid');
                        $('#fechaMuestraTestigo').addClass('is-invalid');
                        $('#error_fechaMuestraTestigo').css('display', 'block');
                    } else {
                        $('#fechaMuestraTestigo').removeClass('is-invalid');
                        $('#fechaMuestraTestigo').addClass('is-valid');
                        $('#error_fechaMuestraTestigo').css('display', 'none');
                    }
                });

                $('.muestrasFuera').change(function () {
                    if ($('.muestrasFuera').val() == "" || $('.muestrasFuera').val() == 0) {
                        $('.muestrasFuera').removeClass('is-valid');
                        $('.muestrasFuera').addClass('is-invalid');
                        $('#error_muestrasFuera').css('display', 'block');
                    } else {
                        $('.muestrasFuera').removeClass('is-invalid');
                        $('.muestrasFuera').addClass('is-valid');
                        $('#error_muestrasFuera').css('display', 'none');
                    }
                });

                $('.chkEnseres').change(function(){
                    ocultaControles();
                    var pregunta = $("#pregunta").val();
                    $('#fechaProgramada').val('');
                    $('#fechaIncidencia').val('');
                    $('#fechaEntrega').val('');
                    $('.muestrasFuera').val(1);
                    $('#inciComentarios').val('');
                    muestraControles(pregunta);
                });

            /********************************* Fin Incidencias************************************/

            /*********************************** Entregables **************************************/
                $('#error_tipoEntre').css('display', 'none');
                $('#error_customFile').css('display', 'none');
                $('#error_comentariosEntre').css('display', 'none');

                axios.get("/comedor/getEntregables/"+model.id+"/"+model.servicioId).then(response => {
                    if (response.data == null || response.data == "") {
                        $('#tEntregables').html(response.data);
                    }
                    $('#tEntregables').html(response.data);
                });

                $('.btn_addFile').click(function () {
                     var option = '<option value="">Seleccione un Entregable</option>';
                     axios.get('/variables/getEntregables/' + model.servicioId + "/" + model.id).then(entre => {
                         entre = entre.data;
                         for (var i = 0; i < entre.length; i++) {
                             option += "<option value='" + entre[i].abreviacion + "'>" + entre[i].valor + "</option>";
                         }
                         $('#tipo_entregable').html(option);
                     });
                    $('#customFile').removeClass('is-valid');
                    $('#comentarios_entregable').removeClass('is-valid');
                    $('#tipo_entregable').removeClass('is-valid');
                    $('#customFile').removeClass('is-invalid');
                    $('#comentarios_entregable').removeClass('is-invalid');
                    $('#tipo_entregable').removeClass('is-invalid');
                    $('#error_tipoEntre').css('display', 'none');
                    $('#error_customFile').css('display', 'none');
                    $('#error_comentariosEntre').css('display', 'none');
                    $('#modal_evidencias').modal('show');
                });

                function validaCamposArchivo() {
                    if ($('#tipo_entregable').val() == "" && $('#customFile').val() == "") {
                        $('#tipo_entregable').addClass('is-invalid');
                        $('#error_tipoEntre').css('display', 'block');
                        $('#customFile').addClass('is-invalid');
                        $('#error_customFile').css('display', 'block');
                        return false;
                    }

                    if ($('#tipo_entregable').val() == "") {
                        $('#tipo_entregable').addClass('is-invalid');
                        $('#error_tipoEntre').css('display', 'block');
                        return false;
                    }

                    if (($('#customFile').val() == "" && $('.custom-file-label').text() == "")) {
                        $('#customFile').addClass('is-invalid');
                        $('#error_customFile').css('display', 'block');
                        return false;
                    }

                    return true;
            }

                $("#customFile").on("change", function () {
                    var fileName = $(this).val().split("\\").pop();
                    var ext = fileName.split('.').pop();
                    if (ext == "pdf" || ext == "PDF") {
                        $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
                    } else {
                        Swal.fire({
                            'icon': 'error',
                            'title': 'Servicio de Comedor General',
                            'text': 'El archivo que intenta adjuntar no es válido. Favor de solo seleccionar archivos "PDF"'
                        });
                        $(".custom-file-label").text("Seleccionar Archivo");
                        document.getElementById('customFile').value = '';
                        if ($('#customFile').hasClass('is-valid')) {
                            $('#customFile').removeClass('is-valid');
                        }
                        $('#customFile').addClass('is-invalid');
                        $('#error_customFile').css('display', 'block');
                    }
                });

                $('#tipo_entregable').change(function () {
                    if ($('#tipo_entregable').val() == "") {
                        $('#tipo_entregable').addClass('is-invalid');
                        $('#error_tipoEntre').css('display', 'block');
                        return false;
                    } else {
                        $('#tipo_entregable').removeClass('is-invalid');
                        $('#tipo_entregable').addClass('is-valid');
                        $('#error_tipoEntre').css('display', 'none');
                    }
                });

                $('#customFile').change(function () {
                    if ($('#customFile').val() == "") {
                        $('#customFile').addClass('is-invalid');
                        $('#error_customFile').css('display', 'block');
                    } else {
                        var fileName = $("#customFile").val().split("\\").pop();
                        var ext = fileName.split('.').pop();
                        if (ext != "pdf") {
                            $('#customFile').addClass('is-invalid');
                            $('#error_customFile').css('display', 'block');
                        } else {
                            $('#customFile').removeClass('is-invalid');
                            $('#customFile').addClass('is-valid');
                            $('#error_customFile').css('display', 'none');
                        }
                    }
                });

                $('#comentarios_entregable').change(function () {
                    if ($('#comentarios_entregable').val() == "") {
                        $('#comentarios_entregable').addClass('is-invalid');
                        $('#error_comentariosEntre').css('display', 'block');
                        return false;
                    } else {
                        $('#comentarios_entregable').removeClass('is-invalid');
                        $('#comentarios_entregable').addClass('is-valid');
                        $('#error_comentariosEntre').css('display', 'none');
                    }
                });

                $('#adjuntarArchivo').click(function () {
                    var formData = new FormData();
                    var file = document.getElementById('customFile').files[0];
                    var id = $('#file_id').val();
                    var tipo = $('#tipo_entregable').val();
                    var comentarios = $('#comentarios_entregable').val();

                    if (id.length > 0) {
                        id = parseInt(id);
                    } else {
                        id = 0;
                    }

                    formData.append("Id", id);
                    formData.append("CedulaEvaluacionId", model.id);
                    formData.append("Folio", model.folio);
                    formData.append("Tipo", tipo);
                    formData.append("Comentarios", comentarios);
                    if (file != null) {
                        formData.append("Archivo", file);
                    }

                    if (validaCamposArchivo()) {
                        axios.post('/comedor/adjuntaEntregable', formData, { headers: { 'Content-Type': 'multipart/form-data' } }).then(response => {
                            $('#cerrar_modal_sua').trigger('click');
                            if (response.status == 200) {
                                Swal.fire({
                                    'icon': "success",
                                    'title': 'Servicio de Comedor General',
                                    'text': 'Se adjuntó el archivo de correctamente.'
                                }).then(function () {
                                    axios.get("/comedor/getEntregables/" + model.id + "/" + model.servicioId).then(success => {
                                        if (success.data == null || success.data == "") {
                                            $('#tEntregables').html(success.data);
                                        }
                                        $('#tEntregables').html(success.data);
                                    });
                                });
                            }
                        });
                    }
                    document.getElementById('customFile').value = '';
                    $('#file_id').val("");
                    $(".custom-file-label").text("Seleccionar Archivo");
                    $('#tipo_entregable').val('');
                    $('#comentarios_entregable').val('');
                    $('#customFile').removeClass('is-valid');
                    $('#comentarios_entregable').removeClass('is-valid');
                    $('#tipo_entregable').removeClass('is-valid');
                });

                $(document).on("click", ".update_files", function () {
                    $('#modal_evidencias').modal('show');
                    var id = $(this).data('id');
                    var tipo = $(this).data('tipo');
                    var coments = $(this).data('coments');
                    var file = $(this).data('file');
                    $('#file_id').val(parseInt(id));
                    $(".custom-file-label").text(file);
                    $('#tipo_entregable').val(tipo);
                    $('#comentarios_entregable').val(coments);
                    $('#modal_evidencias').modal('show');
                });

                $(document).on("click", ".delete_files", function () {
                    let id = $(this).data('id');
                    let tipo = $(this).data('tipo');
                    Swal.fire({
                        'icon': 'warning',
                        'title': 'Servicio de Comedor General',
                        'text': '¿Está seguro de eliminar el archivo relacionado a "' + tipo + '"?',
                        'confirmButtonColor': '#3085d6',
                        'cancelButtonColor': '#d33',
                        'confirmButtonText': 'Si, Eliminar Archivo',
                        'cancelButtonText': 'Cancelar',
                        'showCancelButton': true
                    }).then(response => {
                        if (response.isConfirmed) {
                            axios.post("/comedor/eliminaArchivo", { Id: id, Folio: model.folio }).then(response => {
                                if (response.status == 200) {
                                    Swal.fire({
                                        'icon': 'success',
                                        'title': 'Servicio de Comedor General',
                                        'html': 'El archivo fue eliminado con éxito.',
                                    }).then(function () {
                                        axios.get("/comedor/getEntregables/" + model.id + "/" + model.servicioId).then(response => {
                                            if (response.data == null || response.data == "") {
                                                $('#tEntregables').html(response.data);
                                            }
                                            $('#tEntregables').html(response.data);
                                        });
                                    });
                                }
                            }).catch(error => {
                                Swal.fire({
                                    'icon': 'error',
                                    'title': 'Servicio de Comedor General',
                                    'html': 'No se pudo procesar tu solicitud. Contacta a tu Administrador.',
                                });
                            });
                        }
                    });
                });

                $(document).on('click', '.view_file', function () {
                    let nombre = $(this).data('file');
                    let tipo = $(this).data('tipo');
                    let data = "<object width='100%' height='710px' data='/view/entregable/" + model.folio + "/" + nombre + "'></object>";
                    $('#titlePDF').text("PDF - \"" + tipo + "\"");
                    $('#objectPdf').html(data);
                    $('#show_pdf').modal('show');
                });
            /********************************* Fin Entregables ************************************/

            /********************************* Editar Cuestionario ************************************/
                if (respuestas != null && respuestas.length != 0) {
                    for (var i = 0; i < respuestas.length; i++) {
                        for (var j = 0; j < model.preguntas.length; j++) {
                            if (respuestas[i].pregunta == model.preguntas[j].noPreguntaUsuario) {
                                if (respuestas[i].respuesta == false && model.preguntas[j].cierre) {
                                    $("#fechaCierre").val(respuestas[i].detalles);
                                }
                                else if (respuestas[i].respuesta == false && model.preguntas[j].fechas) {
                                    if (respuestas[i].detalles == "N/A") {
                                        $('input:radio[name="pregunta_' + respuestas[i].pregunta + '"][value="N/A"]').prop('checked', true);
                                    } else {
                                        $('input:radio[name="pregunta_' + respuestas[i].pregunta + '"][value="false"]').prop('checked', true);
                                        var fechas = respuestas[i].detalles;
                                        $("#fechaProgramada_" + respuestas[i].pregunta).val(fechas.split("|")[0]);
                                        $("#fechaEntrega_" + respuestas[i].pregunta).val(fechas.split("|")[1]);
                                        $("#divIncidencias_" + respuestas[i].pregunta).css("display", "block");
                                    }
                                }
                                else if (respuestas[i].respuesta == false) {
                                    if (respuestas[i].detalles == "N/A" || respuestas[i].detalles == "N/R" || respuestas[i].detalles == "N/E") {
                                        $('input:radio[name="pregunta_' + respuestas[i].pregunta + '"][value="' + respuestas[i].detalles+'"]').prop('checked', true);
                                    } else {
                                        $('input:radio[name="pregunta_' + respuestas[i].pregunta + '"][value="false"]').prop('checked', true);
                                        if (model.preguntas[j].incidencias && (respuestas[i].pregunta != 9 && respuestas[i].pregunta != 10 /*&&
                                            respuestas[i].pregunta != 23*/)) {
                                            $("#divIncidencias_" + respuestas[i].pregunta).css("display", "block");
                                        }
                                    }
                                } else if (respuestas[i].respuesta == true) {
                                    $('input:radio[name="pregunta_' + respuestas[i].pregunta + '"][value="true"]').prop('checked', true);
                                    if (model.preguntas[j].incidencias && (respuestas[i].pregunta == 9 || respuestas[i].pregunta == 10)) {
                                        $("#divIncidencias_" + respuestas[i].pregunta).css("display", "block");
                                    }
                                }
                            }
                        }
                    }
                }
            /********************************* Editar Cuestionario ************************************/

            /********************************* Guardar/Enviar Cuestionario ************************************/
                $('.btn_guardar').click(function () {
                    var respuestas = new Array();
                    let detalles = "";
                    for (let i = 0; i < model.preguntas.length; i++) {
                        let respuesta = $("input[name=pregunta_" + (i + 1) + "]:checked").val();
                        detalles = null;
                        if (model.preguntas[i].noPreguntaUsuario == 1 && model.preguntas[i].cierre) {
                            respuestas.push({ CedulaEvaluacionId: parseInt(model.id), Pregunta: (i + 1), Respuesta: "false", Detalles: $("#fechaCierre").val() });
                        } else if (respuesta != null && respuesta != undefined) {
                            if (model.preguntas[i].fechas) {
                                if (respuesta == "false") {
                                    detalles = $("#fechaProgramada_" + model.preguntas[i].noPreguntaUsuario).val() + "|" + $("#fechaEntrega_" + model.preguntas[i].noPreguntaUsuario).val();
                                } else if (respuesta == "N/A") {
                                    detalles = respuesta;
                                } else if (respuesta == "N/E") {
                                    detalles = respuesta;
                                } else {
                                    detalles = null;
                                }
                            }
                            else if (model.preguntas[i].incidencias) {
                                if (respuesta == "N/A") {
                                    detalles = respuesta;
                                } else if (respuesta == "N/R") {
                                    detalles = respuesta;
                                }
                            }

                            respuestas.push({ CedulaEvaluacionId: parseInt(model.id), Pregunta: (i + 1), Respuesta: (respuesta == "true"), Detalles: detalles });
                        }
                    }
                    if (respuestas.length >0) {
                        axios.post("/comedor/evaluation", respuestas).then(response => {
                            if (response.status == 200) {
                                Swal.fire({
                                    'icon': "success",
                                    'title': 'Servicio de Comedor General',
                                    'html': "Se guardaron las respuestas de la cédula correctamente."
                                }).then(function () {
                                    window.location.reload();
                                });
                            } else {
                                Swal.fire({
                                    'icon': "error",
                                    'title': 'Servicio de Comedor General',
                                    'html': "Hubo un error al guardar la(s) respuesta(s) de la cédula. Contacte al Administrador del Sistema"
                                });
                            }
                        });
                    }

                 });

                function cuentaincidenciasComedor(pregunta) {
                    var isContinue = true;
                    $.ajax({
                        url: '/comedor/totalIncidencia/' + model.id + '/' + pregunta,
                        type: 'GET',
                        async: false,
                        success: function (json) {
                            json == 0 ? isContinue = false : true;
                        },
                    });
                    return isContinue;
            }

                function guardaCedula(){
                    var respuestas = new Array();
                    for (let i = 0; i < model.preguntas.length; i++) {
                        let respuesta = $("input[name=pregunta_" + (i + 1) + "]:checked").val();
                        detalles = null;
                        if (model.preguntas[i].noPreguntaUsuario == 1 && model.preguntas[i].cierre) {
                            respuestas.push({ CedulaEvaluacionId: parseInt(model.id), Pregunta: (i + 1), Respuesta: "false", Detalles: $("#fechaCierre").val() });
                        } else if (respuesta != null && respuesta != undefined) {
                            if (model.preguntas[i].fechas) {
                                if (respuesta == "false") {
                                    detalles = $("#fechaProgramada_" + model.preguntas[i].noPreguntaUsuario).val() + "|" + $("#fechaEntrega_" + model.preguntas[i].noPreguntaUsuario).val();
                                } else if (respuesta == "N/A") {
                                    detalles = respuesta;
                                } else if (respuesta == "N/E") {
                                    detalles = respuesta;
                                } else {
                                    detalles = null;
                                }
                            }
                            else if (model.preguntas[i].incidencias) {
                                if (respuesta == "N/A") {
                                    detalles = respuesta;
                                } else if (respuesta == "N/R") {
                                    detalles = respuesta;
                                }
                            }

                            respuestas.push({ CedulaEvaluacionId: parseInt(model.id), Pregunta: (i + 1), Respuesta: (respuesta == "true"), Detalles: detalles });
                        }
                    }

                     axios.post("/comedor/evaluation", respuestas).then(response => {
                         if (response.status == 200) {

                         } else {
                             Swal.fire({
                                 'icon': "error",
                                 'title': 'Servicio de Comedor General',
                                 'html': "Hubo un error al guardar la(s) respuesta(s) de la cédula. Contacte al Administrador del Sistema"
                             });
                         }
                     });
                }

                function validaEntregables() {
                    var msgEntregables = ["Factura", "Validación del SAT"];
                    var entregables = ["Factura", "SAT"];
                    var msg = "";
                    var nota = false;
                    var found = false;
                    axios.get('/comedor/getListadoEntregables/' + model.id + "/" + model.servicioId).then(response => {
                        for (var j = 0; j < entregables.length; j++) {
                            for (var i = 0; i < response.data.length; i++) {
                                if (entregables[j] == response.data[i].tipo) {
                                    found = true;
                                    break;
                                } else {
                                    found = false;
                                }
                            }
                            if (!found) {
                                msg += "<strong> - "+msgEntregables[j]+"<br/></strong>";
                            }
                        }

                        if (msg != "") {
                            Swal.fire({
                                'icon': 'error',
                                'title': 'Servicio de Comedor General',
                                'html': 'Para enviar la cédula a la DAS, es necesario adjuntar los siguientes entregables: <br/><br/>' + msg
                            });
                            return false;
                        } else {
                            $('.btn_enviar').attr('disabled', true);
                            $('.btn_guardar').attr('disabled', true);
                            axios.post('/comedor/historialComedor',
                                {
                                    ServicioId: model.servicioId, CedulaId: model.id, UsuarioId: parseInt(@User.Claims.ElementAt(0).Value), Estatus: "Enviado a DAS",
                                    Comentarios: "Se envía la cédula a la DAS para su revisión."
                                }
                            ).then(response => {
                                 axios.post("/comedor/sendCedula/" + model.servicioId + "/" + model.id).then(response => {
                                     if (response.status == 200) {
                                         Swal.fire({
                                             'icon': "success",
                                             'title': 'Servicio de Comedor General',
                                             'html': "Se envió la cédula correctamente."
                                         }).then(function () {
                                             window.location.href = "/comedor/index/" + model.servicioId;
                                         });
                                     } else {
                                         Swal.fire({
                                             'icon': "error",
                                             'title': 'Servicio de Comedor General',
                                             'html': "Hubo un error al guardar las respuestas de la cédula. Contacte al Administrador del Sistema"
                                         });
                                     }
                                 });
                             });
                        }
                    });
                }

                function buscaPregunta(pregunta) {
                    let respuesta = $("input[name=pregunta_" + pregunta + "]:checked").val();
                    let exists = -1;

                    if (pregunta == 1 && model.preguntas[pregunta - 1].cierre)
                    {
                        return pregunta;
                    }
                    else
                    {
                        for (let i = 0; i < model.respuestasEncuesta.length; i++) {
                            if (pregunta == model.respuestasEncuesta[i].pregunta) {
                                exists = 1;
                            }
                        }

                        if (exists == 1 && respuesta != null && respuesta != undefined && respuesta != "") {
                            return model.preguntas[pregunta - 1].noPregunta;
                        }
                    }

                    return exists;
                }

                function muestraMensaje(pregunta){
                    for (var i = 0; i < model.preguntas.length; i++) {
                        if (model.preguntas[i].noPregunta == pregunta) {
                            if (model.preguntas[i].cierre) {
                                Swal.fire({
                                    'icon': 'error',
                                    'title': 'Servicio de Comedor General',
                                    'html': 'No ha capturado la fecha de cierre en la <strong>Pregunta ' + model.preguntas[i].noPreguntaUsuario + '</strong>'
                                });
                            } else if (model.preguntas[i].fechas) {
                                Swal.fire({
                                    'icon': 'error',
                                    'title': 'Servicio de Comedor General',
                                    'html': 'No ha capturado la <strong>Pregunta ' + model.preguntas[i].noPreguntaUsuario + '</strong> o falta capturar la <strong>Fecha de Programada y/o Fecha de Entrega</strong>.'
                                });
                            } else if (model.preguntas[i].incidencias) {
                                Swal.fire({
                                    'icon': 'error',
                                    'title': 'Servicio de Comedor General',
                                    'html': 'No ha capturado la <strong>Pregunta ' + model.preguntas[i].noPreguntaUsuario + '</strong> o aún falta capturar las <strong>incidencias</strong>.'
                                });
                            }
                        }
                    }
                }

                $('.btn_enviar').click(function () {
                    guardaCedula();
                    let pregunta = 0;
                    let i = 0;
                    let respuesta = "";
                    let isContinue = true;
                    if (model.facturas.length == 0) {
                        Swal.fire({
                            'icon': 'error',
                            'title': 'Servicio de Comedor General',
                            'html': 'No ha registrado ninguna factura en la cédula'
                        });
                        return false;
                    }

                    for (i = 0; i < model.preguntas.length; i++) {
                        respuesta = $('input:radio[name="pregunta_' + (i + 1) + '"]:checked').val();
                        if (buscaPregunta(model.preguntas[i].noPreguntaUsuario) != -1) {
                            pregunta = buscaPregunta(model.preguntas[i].noPreguntaUsuario);
                            if (pregunta == 1 && $("#fechaCierre").val() == "") {
                                break;
                            } else if (respuesta == "false" && (pregunta != 10 && pregunta != 11)) {
                                if (model.preguntas[i].incidencias) {
                                    isContinue = cuentaincidenciasComedor(model.preguntas[i].noPregunta);
                                    if (isContinue == false) {
                                        break;
                                    }
                                } else if (model.preguntas[i].fechas) {
                                    if ($("#fechaEntrega_" + model.preguntas[i].noPregunta).val() == "" ||
                                        $("#fechaProgramada_" + model.preguntas[i].noPregunta).val() == "") {
                                        break;
                                    }
                                }
                            } else if (respuesta == "true" && (pregunta == 10 || pregunta == 11)) {
                                if (model.preguntas[i].incidencias) {
                                    isContinue = cuentaincidenciasComedor(model.preguntas[i].noPregunta);
                                    if (isContinue == false) {
                                        break;
                                    }
                                }
                            }
                        } else {
                            pregunta = model.preguntas[i].noPregunta;
                            break;
                        }
                    }

                    if (i < (model.preguntas.length)) {
                        muestraMensaje(pregunta)
                        return false;
                    } else {
                        validaEntregables();
                    }
                });

            /******************************* FIN Guardar/Enviar Cuestionario **********************************/
        });
    </script>
}