@model CedulasEvaluacion.Entities.MCedula.CedulaEvaluacion;
@{
    var title = TempData["Title"] as string;
    //ViewData["Title"] = "Revisión de la Cédula del Servicio de Transporte para Personas Servidoras Públicas: " + Model.Folio;

    <div class="titulo-principal">
        <b>
            Revisión de la Cédula del Servicio de Transporte para Personas Servidoras Públicas
        </b> <i class="fa-sharp fa-solid fa-bus-school mr-2"></i>
    </div>
}

<div class="row align-items-center mb-4 border-bottom pb-3">
    <div class="col-lg-1 d-none d-lg-block text-center border-right pr-3">
        <i class="fas fa-file-signature fa-3x text-primary"></i>
    </div>
    <div class="col-lg-8 col-md-9">
        <h4 class="mb-1 text-dark">
            <span class="font-weight-bold display-5 text-decoration-underline" style="color: #24135f;">@Model.Folio</span> <br>
            <small class="d-block text-muted mt-2">
                <i class="fas fa-calendar-alt mr-2"></i> Evaluación correspondiente al mes de <b class="text-dark">@Model.Mes</b> del año <b class="text-dark">@Model.Anio</b>
            </small>
        </h4>
    </div>
    <div class="col-lg-3 col-md-3 text-right">
        <a href="/transporte/index/@Model.ServicioId@Model.URL" type='button' class='btn btn-warning btn-lg shadow-sm' data-toggle="tooltip" title="Regresar al listado de cédulas" data-placement="top" style="padding: 3px 72px;">
            <i class="fas fa-arrow-left mr-2"></i> Regresar
        </a>
    </div>
</div>

<div class="row">
    <div class="col-lg-12">
        @if (Model.Folio.Contains("202503N") || Model.Anio > 2025 || (Model.Anio == 2025 && (Model.Mes == "Abril" ||
                         Model.Mes == "Mayo" ||
                         Model.Mes == "Junio" ||
                         Model.Mes == "Julio" ||
                         Model.Mes == "Agosto" ||
                         Model.Mes == "Septiembre" ||
                         Model.Mes == "Octubre" ||
                         Model.Mes == "Noviembre" ||
                         Model.Mes == "Diciembre")))
        {
            <div style="margin-bottom: 30px;">
                <ul class="nav nav-tabs h6" id="myTabRow1" role="tablist">
                    <li class="nav-item" role="presentation">
                        <a class="nav-link1 active" id="informacion-general-tab" data-toggle="tab" href="#informacion_general" role="tab" aria-controls="informacion_general" aria-selected="true">Información General</a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link1" id="entregables-tab" data-toggle="tab" href="#entregables_cedula" role="tab" aria-controls="entregables_cedula" aria-selected="false">Entregables</a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link1" id="seguimiento-tab" data-toggle="tab" href="#historial_cedula" role="tab" aria-controls="historial_cedula" aria-selected="false">Seguimiento a la Cédula</a>
                    </li>
                </ul>
            </div>

            <ul class="nav nav-tabs h6" id="myTabRow2" role="tablist">
                <li class="nav-item" role="presentation">
                    <a class="nav-link1" id="fecha-cierre-tab" data-toggle="tab" href="#fecha_cierre_servicio" role="tab" aria-controls="fecha_cierre_servicio" aria-selected="false">1. Fecha de Cierre del Servicio</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link1" id="obligaciones-generales-tab" data-toggle="tab" href="#obligaciones_generales" role="tab" aria-controls="obligaciones_generales" aria-selected="false">2. Obligaciones Generales</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link1" id="entrega-documentos-tab" data-toggle="tab" href="#entrega_documentos" role="tab" aria-controls="entrega_documentos" aria-selected="false">3. Entrega de Documentos</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link1" id="infraestructura-tab" data-toggle="tab" href="#infraestructura" role="tab" aria-controls="infraestructura" aria-selected="false">4. Infraestructura</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link1" id="capacitacion-operador-tab" data-toggle="tab" href="#capacitacion_operador" role="tab" aria-controls="capacitacion_operador" aria-selected="false">5. Capacitación del Operador</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link1" id="obligaciones-operadores-tab" data-toggle="tab" href="#obligaciones_operadores" role="tab" aria-controls="obligaciones_operadores" aria-selected="false">6. Obligaciones de los Operadores</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link1" id="horariosrutas-operadores-tab" data-toggle="tab" href="#horarios_rutas" role="tab" aria-controls="horarios_rutas" aria-selected="false">7. Horarios y Rutas</a>
                </li>
            </ul>
        }
        else
        {
            <ul class="nav nav-tabs h6" id="myTab" role="tablist">

                <li class="nav-item" role="presentation">
                    <a class="nav-link1 active" id="home-tab" data-toggle="tab" href="#informacion_general" role="tab" aria-controls="home" aria-selected="true">Información General</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link1" id="contact-tab" data-toggle="tab" href="#horarios" role="tab" aria-controls="contact" aria-selected="false">1. Recorridos y Horarios</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link1" id="contact-tab" data-toggle="tab" href="#registro" role="tab" aria-controls="contact" aria-selected="false">2. Registro de Servidores Públicos</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link1" id="contact-tab" data-toggle="tab" href="#ocupacion" role="tab" aria-controls="contact" aria-selected="false">3. Requisitos Mínimos</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link1" id="contact-tab" data-toggle="tab" href="#supervision" role="tab" aria-controls="contact" aria-selected="false">4. Supervisión del Servicio</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link1" id="contact-tab" data-toggle="tab" href="#comportamiento" role="tab" aria-controls="contact" aria-selected="false">5. Comportamiento del Personal</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link1" id="contact-tab" data-toggle="tab" href="#entregables_cedula" role="tab" aria-controls="contact" aria-selected="false">Entregables</a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link1" id="contact-tab" data-toggle="tab" href="#historial_cedula" role="tab" aria-controls="contact" aria-selected="false">Seguimiento a la Cédula</a>
                </li>
            </ul>
        }

        @{ int f = 0;}
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="informacion_general" role="tabpanel" aria-labelledby="home-tab">
                <div class="row justify-content-center align-items-center mt-4">
                    <div class="col-lg-12 h3 ml-4">
                        <h4 style="color: #24135f;">
                            <i class="fas fa-info-circle me-2"></i> <strong>Información General</strong>
                        </h4>

                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12 mt-3">
                        <div class="card bg-light d-flex flex-fill">
                    
                            <div class="card-body pt-0 mt-4">
                                <div class="row">
                                    <div class="col-7">
                                        <h5 class="mb-0 text-dark">
                                            <i class="fal fa-file-invoice mr-1"></i> <strong>Facturas Capturadas:</strong>
                                            <a href="#" id="btn_facturas" class='btn btn-lg btn-facturas ml-2 mb-1' data-toggle="tooltip" title="Ver Facturas" data-placement="top">
                                                <i class="fal fa-file-invoice"></i>
                                            </a>
                                        </h5>
                                        <ul class="ml-4 mb-0 fa-ul">
                                            <li class="strong mt-3"><span class="fa-li"><i class="fas fa-building me-2"></i></span> <h5><strong>Inmueble Evaluado: </strong> <span>@Model.inmuebles.Nombre</span></h5></li>
                                            <li class="strong mt-3"><span class="fa-li"><i class="fas fa-lg fa-dollar-sign"></i></span> <h5><strong>Facturación Total: </strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", Model.TotalMontoFactura)</h5></li>
                                            <li class="strong mt-3"><span class="fa-li"><i class="fad fa-star"></i></span> <h5> <strong>Calificación: </strong> </b> @Model.Calificacion</h5></li>
                                            <li class="strong mt-3"><span class="fa-li"><i class="fas fa-lg fa-user"></i></span>  <h5><strong>Elaboró: </strong> @Model.usuarios.nombre_emp @Model.usuarios.paterno_emp @Model.usuarios.materno_emp</h5></li>
                                            <li class="strong mt-3">
                                                <span class="fa-li"><i class="fas fa-lg fa-envelope mb-1"></i></span>

                                                @if (@Model.usuarios.correo_electronico.Equals("") || @Model.usuarios.correo_electronico.Equals(null))
                                                {
                                                    <h5><strong>Correo:</strong><strong class="text-danger">@String.Format("Sin correo")</strong></h5>
                                                }
                                                else
                                                {
                                                    <h5><strong>Correo:</strong> @Model.usuarios.correo_electronico</h5>
                                                }

                                            </li>
                                        </ul>
                                        <br><br>

                                        @{
                                            decimal totalDeductivas = 0;
                                            decimal totalPenalizaciones = 0;
                                        }
                                        @if (Model.Folio.Contains("202503N") || Model.Anio > 2025 || (Model.Anio == 2025 && (Model.Mes == "Abril" ||
                                                                                                                      Model.Mes == "Mayo" ||
                                                                                                                      Model.Mes == "Junio" ||
                                                                                                                      Model.Mes == "Julio" ||
                                                                                                                      Model.Mes == "Agosto" ||
                                                                                                                      Model.Mes == "Septiembre" ||
                                                                                                                      Model.Mes == "Octubre" ||
                                                                                                                      Model.Mes == "Noviembre" ||
                                                                                                                      Model.Mes == "Diciembre")))
                                        {

                                            // Calculamos totalPenalizaciones: índices [1] y [2]
                                            if (Model.RespuestasEncuesta != null)
                                            {
                                                // Si el índice 1 existe, sumamos su MontoPenalizacion
                                                if (Model.RespuestasEncuesta.Count > 1)
                                                {
                                                    totalPenalizaciones += Model.RespuestasEncuesta[1].MontoPenalizacion;
                                                }
                                                // Si el índice 2 existe, sumamos su MontoPenalizacion
                                                if (Model.RespuestasEncuesta.Count > 2)
                                                {
                                                    totalPenalizaciones += Model.RespuestasEncuesta[2].MontoPenalizacion;
                                                }
                                            }

                                            // Calculamos totalDeductivas: índices [3] al [7]
                                            if (Model.RespuestasEncuesta != null)
                                            {
                                                // Verificamos que al menos el índice 7 exista para poder sumar del 3 al 7
                                                if (Model.RespuestasEncuesta.Count > 6)
                                                {
                                                    totalDeductivas = Model.RespuestasEncuesta[3].MontoPenalizacion +
                                                                      Model.RespuestasEncuesta[4].MontoPenalizacion +
                                                                      Model.RespuestasEncuesta[5].MontoPenalizacion +
                                                                      Model.RespuestasEncuesta[6].MontoPenalizacion;
                                                }
                                                // CONSIDERACIÓN: Si no todos los índices del 3 al 7 siempre existen,
                                                // podrías necesitar sumarlos individualmente con sus propias validaciones (ver abajo).
                                            }

                                        }
                                        else
                                        {
                                            if (Model.RespuestasEncuesta != null && Model.RespuestasEncuesta.Count > 1)
                                            {
                                                totalPenalizaciones = Model.RespuestasEncuesta[1].MontoPenalizacion;
                                            }

                                            if (Model.RespuestasEncuesta != null && Model.RespuestasEncuesta.Count > 5)
                                            {
                                                totalDeductivas = Model.RespuestasEncuesta[2].MontoPenalizacion +
                                                                          Model.RespuestasEncuesta[3].MontoPenalizacion +
                                                                          Model.RespuestasEncuesta[4].MontoPenalizacion +
                                                                          Model.RespuestasEncuesta[5].MontoPenalizacion;
                                            }
                                        }


                                    </div>
                                    <div class="col-5">
                                        <h2 class="@(Model.Fondo.Replace("bg", "text")) lblEstatus">
                                            @Html.Raw(Model.Icono)
                                            <strong class="ml-2">Estatus: </strong> @Model.Estatus
                                        </h2>
                                    </div>
                                </div>

                                <div class="row mt-4 justify-content-center align-items-stretch">
                                    <div class="col-12 col-md-4 mb-4">


                                        @if (totalPenalizaciones > 0)
                                        {
                                            <div class="card border-danger text-center">
                                                <div class="card-body">
                                                    <h5 class="card-title text-danger mb-2">
                                                        <i class="fas fa-minus-circle me-2"></i> <strong>Total de Penalizaciones sin IVA:</strong>
                                                    </h5>
                                                    <p class="card-text display-4 text-danger fw-bold">
                                                        <strong>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", totalPenalizaciones)</strong>
                                                    </p>
                                                </div>
                                            </div>
                                        }
                                        else
                                        {

                                        }
                                    </div>
                                    <div class="col-12 col-md-4 mb-4">
                                        @if (totalDeductivas > 0)
                                        {
                                            <div class="card border-primary text-center">
                                                <div class="card-body">
                                                    <h5 class="card-title text-primary mb-2">
                                                        <i class="fas fa-calculator me-2"></i> <strong>Total de Deductivas sin IVA:</strong>
                                                    </h5>
                                                    <p class="card-text  display-4 text-primary fw-bold">
                                                        <strong>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", totalDeductivas)</strong>
                                                    </p>
                                                </div>
                                            </div>
                                        }
                                        else
                                        {

                                        }
                                    </div>
                                </div>
                            </div>
                            @if (Model.Estatus.Equals("Enviado a DAS"))
                            {
                                <div class="card-footer">
                                    <div class="text-right">
                                        <button href="" class="btn btn-danger float-right mr-3 failed_cedula"><i class="fas fa-times mr-2"></i>Rechazar Cédula</button>
                                        <button href="" class="btn btn-success float-right mr-3 success_cedula"><i class="fas fa-check mr-2"></i>Aceptar Cédula</button>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>

            @if (Model.Folio.Contains("202503N") || Model.Anio > 2025 || (Model.Anio == 2025 && (Model.Mes == "Abril" ||
                                          Model.Mes == "Mayo" ||
                                          Model.Mes == "Junio" ||
                                          Model.Mes == "Julio" ||
                                          Model.Mes == "Agosto" ||
                                          Model.Mes == "Septiembre" ||
                                          Model.Mes == "Octubre" ||
                                          Model.Mes == "Noviembre" ||
                                          Model.Mes == "Diciembre")))
            {
                <div class="tab-pane fade" id="fecha_cierre_servicio" role="tabpanel" aria-labelledby="contact-tab">
                    <div class="col-lg-12 h3 mt-4">
                        <h4 style="color: #24135f;">
                            <i class="fas fa-calendar-alt me-2"></i> <strong>Fecha de Cierre del Servicio</strong>
                        </h4>
                    </div>
                    @if (@Model.RespuestasEncuesta[0].Respuesta == true)
                    {
                        <div class="row justify-content-center mt-5">
                            <div class="col-lg-6 col-md-8 col-sm-10">
                                <div class="card text-center border-left-primary shadow h-100 py-2">
                                    <div class="card-body">
                                        @foreach (var inci in @Model.RespuestasEncuesta)
                                        {
                                            if (inci.Pregunta.Equals(1))
                                            {
                                                <div class="row no-gutters align-items-center">
                                                    <div class="col mr-2">
                                                        <div class="h3 font-weight-bold text-primary text-uppercase mb-1">
                                                            Fecha de Cierre del Mes:
                                                        </div>
                                                        <div class="h3 mb-0 font-weight-bold text-gray-800">
                                                            @inci.Detalles
                                                        </div>
                                                    </div>
                                                    <div class="col-auto">
                                                        <i class="fas fa-calendar-alt fa-2x text-gray-300"></i>
                                                    </div>
                                                </div>
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>

                    }
                    else
                    {
                        <div class="col-lg-9 mt-3 ml-4">
                            <p class="h3 text-justify text-danger">
                                No se seleccionó la fecha de cierre del servicio.
                                <i class="fas fa-times-circle text-danger fa-2x"></i>
                            </p>
                        </div>
                    }
                </div>
                <div class="tab-pane fade" id="obligaciones_generales" role="tabpanel" aria-labelledby="profile-tab">
                    <div class="col-lg-12 h3 mt-4">
                        <h4 style="color: #24135f;">
                            <i class="fas fa-check-double me-2"></i> <strong>Obligaciones Generales</strong>
                        </h4>
                    </div>
                    @if (@Model.RespuestasEncuesta[1].Respuesta == false)
                    {
                        <div class="row mt-4">
                            <div class="row col-lg-12 mt-3">
                                <div class="col-lg-9 mt-3 ml-4">
                                    <p class="h2 text-justify text-danger">
                                        El prestador NO cumplió con el servicio de transporte conforme a los plazos y condiciones establecidas.
                                        <i class="fas fa-times-circle text-danger"></i>
                                    </p>
                                </div>
                                <div class="col-lg-9 mt-3 ml-4">
                                    <table class="table table-striped table-hover table-bordered table-sm text-center tabla-incidencias-color">
                                        <thead>
                                            <tr class="bg-primary text-white">
                                                <th>Tipo</th>
                                                <th>Fecha de la Incidencia</th>
                                                <th>Comentarios</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var inci in @Model.incidencias.transporte)
                                            {
                                                if (inci.Pregunta.Equals(2 + ""))
                                                {
                                                    <tr>
                                                        <td>@inci.Tipo</td>
                                                        <td>@inci.FechaIncidencia.ToString("dd/MM/yyyy")</td>
                                                        <td>@inci.Comentarios</td>
                                                    </tr>
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-lg-12">
                                <h3 class="text-danger ml-4">
                                    <i class="fas fa-hand-holding-dollar fa-2x"></i>
                                    <strong>Penalización: </strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[1].MontoPenalizacion)
                                </h3>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="col-lg-9 mt-3 ml-4">
                            <p class="h3 text-justify text-success">
                                El prestador SÍ cumplió con el servicio de transporte conforme a los plazos y condiciones establecidas.
                                <i class="fas fa-check-circle text-success fa-2x"></i>
                            </p>
                        </div>
                    }
                </div>
                <div class="tab-pane fade" id="entrega_documentos" role="tabpanel" aria-labelledby="profile-tab">
                    <div class="col-lg-12 h3 mt-4">
                        <h4 style="color: #24135f;">
                            <i class="fas fa-file-pdf me-2"></i><strong> Entrega de Documentos</strong>
                        </h4>
                    </div>
                    @if (@Model.RespuestasEncuesta[2].Respuesta == false)
                    {
                        <div class="row mt-4">
                            <div class="row col-lg-12 mt-3">
                                <div class="col-lg-9 mt-3 ml-4">
                                    <p class="h2 text-justify text-danger">
                                        El prestador de servicios NO proporcionó los entregables en los plazos establecidos.
                                        <i class="fas fa-times-circle text-danger"></i>
                                    </p>
                                </div>
                                <div class="col-lg-9 mt-3 ml-4">
                                    <table class="table table-striped table-hover table-bordered table-sm text-center tabla-incidencias-color">
                                        <thead>
                                            <tr class="bg-primary text-white">
                                                <th>Tipo</th>
                                                <th>Fecha de la Incidencia</th>
                                                <th>Comentarios</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var inci in @Model.incidencias.transporte)
                                            {
                                                if (inci.Pregunta.Equals(3 + ""))
                                                {
                                                    <tr>
                                                        <td>@inci.Tipo</td>
                                                        <td>@inci.FechaIncidencia.ToString("dd/MM/yyyy")</td>
                                                        <td>@inci.Comentarios</td>
                                                    </tr>
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-lg-12">
                                <h3 class="text-danger ml-4">
                                    <i class="fas fa-hand-holding-dollar fa-2x"></i>
                                    <strong>Penalización:</strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[2].MontoPenalizacion)
                                </h3>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="col-lg-9 mt-3 ml-4">
                            <p class="h3 text-justify text-success">
                                El prestador de servicios proporcionó los entregables en los plazos establecidos.
                                <i class="fas fa-check-circle text-success fa-2x"></i>
                            </p>
                        </div>
                    }
                </div>

                <div class="tab-pane fade" id="infraestructura" role="tabpanel" aria-labelledby="contact-tab">
                    <div class="col-lg-12 h3 mt-4">

                        <h4 style="color: #24135f;">
                            <i class="fas fa-tools me-2"></i> <strong>Infraestructura</strong>
                        </h4>


                    </div>
                    @if (@Model.RespuestasEncuesta[3].Respuesta == false)
                    {
                        <div class="row mt-4">
                            <div class="row col-lg-12 mt-3">
                                <div class="col-lg-9 mt-3 ml-4">
                                    <p class="h2 text-justify text-danger">
                                        El servicio NO se proporcionó con la infraestructura técnica, mecánica, tecnológica y humana solicitada.
                                        <i class="fas fa-times-circle text-danger"></i>
                                    </p>
                                </div>
                                <div class="col-lg-9 mt-3 ml-4">
                                    <table class="table table-striped table-hover table-bordered table-sm text-center tabla-incidencias-color">
                                        <thead>
                                            <tr class="bg-primary text-white">
                                                <th>Tipo</th>
                                                <th>Fecha de la Incidencia</th>
                                                <th>Comentarios</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var inci in @Model.incidencias.transporte)
                                            {
                                                if (inci.Pregunta.Equals(4 + ""))
                                                {
                                                    <tr>
                                                        <td>@inci.Tipo</td>
                                                        <td>@inci.FechaIncidencia.ToString("dd/MM/yyyy")</td>
                                                        <td>@inci.Comentarios</td>
                                                    </tr>
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-lg-12">
                                <h3 class="text-primary ml-4">
                                    <i class="fas fa-hand-holding-dollar fa-2x"></i>
                                    <strong>Deductiva:</strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[3].MontoPenalizacion)
                                </h3>
                            </div>
                        </div>
                    }
                    else
                    {

                        <div class="col-lg-9 mt-3 ml-4">
                            <p class="h3 text-justify text-success">
                                El servicio se proporcionó con la infraestructura técnica, mecánica, tecnológica y humana solicitada.
                                <i class="fas fa-check-circle text-success fa-2x"></i>
                            </p>
                        </div>

                    }
                </div>
                <div class="tab-pane fade" id="capacitacion_operador" role="tabpanel" aria-labelledby="contact-tab">
                    <div class="col-lg-12 h3 mt-4">

                        <h4 style="color: #24135f;">
                            <i class="fas fa-user me-2"></i> <strong>Capacitación del Operador</strong>
                        </h4>


                    </div>
                    @if (@Model.RespuestasEncuesta[4].Respuesta == false)
                    {
                        <div class="row mt-4">
                            <div class="row col-lg-12 mt-3">
                                <div class="col-lg-12 mt-3 ml-4">
                                    <p class="h2 text-justify text-danger">
                                        El personal operador del servicio no está capacitado ni cuenta con la experiencia conforme a lo establecido.
                                        <i class="fas fa-times-circle text-danger"></i>
                                    </p>
                                </div>
                                <div class="col-lg-9 mt-3 ml-4">
                                    <table class="table table-striped table-hover table-bordered table-sm text-center tabla-incidencias-color">
                                        <thead>
                                            <tr class="bg-primary text-white">
                                                <th>Tipo</th>
                                                <th>Fecha de la Incidencia</th>
                                                <th>Comentarios</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var inci in @Model.incidencias.transporte)
                                            {
                                                if (inci.Pregunta.Equals(5 + ""))
                                                {
                                                    <tr>
                                                        <td>@inci.Tipo</td>
                                                        <td>@inci.FechaIncidencia.ToString("dd/MM/yyyy")</td>
                                                        <td>@inci.Comentarios</td>
                                                    </tr>
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-lg-12">
                                <h3 class="text-primary ml-4">
                                    <i class="fas fa-hand-holding-dollar fa-2x"></i>
                                    <strong>Deductiva:</strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[4].MontoPenalizacion)
                                </h3>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="col-lg-9 mt-3 ml-4">
                            <p class="h3 text-justify text-success">
                                El personal operador del servicio está capacitado y cuenta con la experiencia conforme a lo establecido.
                                <i class="fas fa-check-circle text-success fa-2x"></i>
                            </p>
                        </div>
                    }
                </div>
                <div class="tab-pane fade" id="obligaciones_operadores" role="tabpanel" aria-labelledby="contact-tab">
                    <div class="col-lg-12 h3 mt-4">

                        <h4 style="color: #24135f;">
                            <i class="fas fa-scroll me-2"></i> <strong>Obligaciones de los Operadores</strong>
                        </h4>


                    </div>
                    @if (@Model.RespuestasEncuesta[5].Respuesta == false)
                    {
                        <div class="row mt-4">
                            <div class="row col-lg-12 mt-3">
                                <div class="col-lg-12 mt-3 ml-4">
                                    <p class="h2 text-justify text-danger">
                                        El operador del servicio NO cumplió con las obligaciones generales.
                                        <i class="fas fa-times-circle text-danger"></i>
                                    </p>
                                </div>
                                <div class="col-lg-9 mt-3 ml-4">
                                    <table class="table table-striped table-hover table-bordered table-sm text-center tabla-incidencias-color">
                                        <thead>
                                            <tr class="bg-primary text-white">
                                                <th>Tipo</th>
                                                <th>Fecha de la Incidencia</th>
                                                <th>Comentarios</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var inci in @Model.incidencias.transporte)
                                            {
                                                if (inci.Pregunta.Equals(6 + ""))
                                                {
                                                    <tr>
                                                        <td>@inci.Tipo</td>
                                                        <td>@inci.FechaIncidencia.ToString("dd/MM/yyyy")</td>
                                                        <td>@inci.Comentarios</td>
                                                    </tr>
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-lg-12">
                                <h3 class="text-primary ml-4">
                                    <i class="fas fa-hand-holding-dollar fa-2x"></i>
                                    <strong>Deductiva:</strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[5].MontoPenalizacion)
                                </h3>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="col-lg-9 mt-3 ml-4">
                            <p class="h3 text-justify text-success">
                                El operador del servicio cumplió con las obligaciones generales.
                                <i class="fas fa-check-circle text-success fa-2x"></i>
                            </p>
                        </div>
                    }
                </div>
                <div class="tab-pane fade" id="horarios_rutas" role="tabpanel" aria-labelledby="contact-tab">
                    <div class="col-lg-12 h3 mt-4">

                        <h4 style="color: #24135f;">
                            <i class="fas fa-route me-2"></i> <strong>Horarios y Rutas</strong>
                        </h4>


                    </div>
                    @if (@Model.RespuestasEncuesta[6].Respuesta == false)
                    {
                        <div class="row mt-4">
                            <div class="row col-lg-12 mt-3">
                                <div class="col-lg-12 mt-3 ml-4">
                                    <p class="h2 text-justify text-danger">
                                        El prestador del servicio NO cumplió con los horarios y rutas establecidos en el programa de operación.
                                        <i class="fas fa-times-circle text-danger"></i>
                                    </p>
                                </div>
                                <div class="col-lg-9 mt-3 ml-4">
                                    <table class="table table-striped table-hover table-bordered table-sm text-center tabla-incidencias-color">
                                        <thead>
                                            <tr class="bg-primary text-white">
                                                <th>Tipo</th>
                                                <th>Fecha de la Incidencia</th>
                                                <th>Comentarios</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var inci in @Model.incidencias.transporte)
                                            {
                                                if (inci.Pregunta.Equals(7 + ""))
                                                {
                                                    <tr>
                                                        <td>@inci.Tipo</td>
                                                        <td>@inci.FechaIncidencia.ToString("dd/MM/yyyy")</td>
                                                        <td>@inci.Comentarios</td>
                                                    </tr>
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-lg-12">
                                <h3 class="text-primary ml-4">
                                    <i class="fas fa-hand-holding-dollar fa-2x"></i>
                                    <strong>Deductiva:</strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[6].MontoPenalizacion)
                                </h3>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="col-lg-9 mt-3 ml-4">
                            <p class="h3 text-justify text-success">
                                El prestador del servicio cumplió con los horarios y rutas establecidos en el programa de operación.
                                <i class="fas fa-check-circle text-success fa-2x"></i>
                            </p>
                        </div>
                    }
                </div>
            }
            else
            {


                <div class="tab-pane fade" id="horarios" role="tabpanel" aria-labelledby="contact-tab">
                    <div class="col-lg-12 text-left mt-4">
                        <h4 style="color: #24135f;">
                            <i class="fas fa-route me-2"></i> <strong>Recorridos y Horarios</strong>
                        </h4>
                    </div>
                    @if (@Model.RespuestasEncuesta[1].Respuesta == false)
                    {
                        <div class="row mt-4">
                            <div class="row col-lg-12 mt-3">
                                <p class="h4 text-justify text-danger ml-3">El prestador de servicios no cumplió con los recorridos y horarios establecidos en el contrato, siendo acreedor a una penalización.</p>
                                <div class="col-lg-9 mt-3 ml-4">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Tipo</th>
                                                <th>Fecha de la Incidencia</th>
                                                <th>Hora de la Incidencia</th>
                                                <th>Comentarios</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var inci in @Model.incidencias.transporte)
                                            {
                                                if (inci.Pregunta.Equals(2 + ""))
                                                {
                                                    <tr>
                                                        <td>@inci.Tipo</td>
                                                        <td>@inci.FechaIncidencia.ToString("dd/MM/yyyy")</td>
                                                        <td>@inci.HoraPresentada</td>
                                                        <td>@inci.Comentarios</td>
                                                    </tr>
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-lg-2" style="margin-top: -18px;">
                                    <div class="small-box bg-warning">
                                        <div class="icon">
                                            <i class="fas fa-times-circle text-danger"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-lg-12 text-">
                                <h3 class="text-danger ml-4">
                                    <i class="fas fa-hand-holding-dollar fa-2x"></i>
                                    <strong>Penalización: </strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[1].MontoPenalizacion)
                                </h3>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="row mt-4">
                            <div class="row col-lg-12 mt-3">
                                <div class="col-lg-9 mt-3 ml-4">
                                    <p class="h3 text-justify text-success">El prestador de servicios cumplió con los recorridos y horarios establecidos en el contrato, eviatando la penalización correspondiente.</p>
                                </div>
                                <div class="col-lg-2" style="margin-top: -18px;">
                                    <div class="small-box bg-warning">
                                        <div class="icon">
                                            <i class="fas fa-check-circle text-success"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                <div class="tab-pane fade" id="registro" role="tabpanel" aria-labelledby="profile-tab">
                    <div class="col-lg-12 h3 mt-4">
                        <h4 style="color: #24135f;">
                            <i class="fas fa-list-alt me-2"></i> <strong>Registro de Servidores Públicos</strong>
                        </h4>
                    </div>
                    @if (@Model.RespuestasEncuesta[2].Respuesta == false)
                    {
                        <div class="row mt-4">
                            <div class="row col-lg-12 mt-3">
                                <div class="col-lg-9 mt-3 ml-4">
                                    <p class="h3 text-justify text-danger">
                                        No se llevó a cabo el registro de los servidores públicos que hicieron uso del servicio, los comentarios son los siguientes: <br><br>
                                        @Model.RespuestasEncuesta[2].Detalles
                                    </p>
                                </div>
                                <div class="col-lg-2" style="margin-top: -18px;">
                                    <div class="small-box bg-warning">
                                        <div class="icon">
                                            <i class="fas fa-times-circle text-danger"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-lg-12">
                                <h3 class="text-primary ml-4">
                                    <i class="fas fa-hand-holding-dollar fa-2x"></i>
                                    <strong>Deductiva:</strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[2].MontoPenalizacion)
                                </h3>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="row mt-4">
                            <div class="row col-lg-12 mt-3">
                                <div class="col-lg-9 mt-3 ml-4">
                                    <p class="h3 text-justify text-success">Sí se llevó a cabo el registro de los servidores públicos que hicieron uso del servicio.</p>
                                </div>
                                <div class="col-lg-2" style="margin-top: -18px;">
                                    <div class="small-box bg-warning">
                                        <div class="icon">
                                            <i class="fas fa-check-circle text-success"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    }
                </div>
                <div class="tab-pane fade" id="ocupacion" role="tabpanel" aria-labelledby="profile-tab">
                    <div class="col-lg-12 h3 mt-4">
                        <h4 style="color: #24135f;">
                            <i class="fas fa-clipboard-check me-2"></i><strong> Requisitos Mínimos</strong>
                        </h4>
                    </div>
                    @if (@Model.RespuestasEncuesta[3].Respuesta == false)
                    {
                        <div class="row mt-4">
                            <div class="row col-lg-12 mt-3">
                                <div class="col-lg-9 mt-3 ml-4">
                                    <p class="h5 text-justify text-danger ml-3">
                                        El prestador de servicios no cumplió con los requisitos mínimos, siendo acreedor a una deductiva.<br><br>
                                        @Model.RespuestasEncuesta[3].Detalles
                                    </p>
                                </div>
                                <div class="col-lg-2" style="margin-top: -18px;">
                                    <div class="small-box bg-warning">
                                        <div class="icon">
                                            <i class="fas fa-times-circle text-danger"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-lg-12">
                                <h3 class="text-primary ml-4">
                                    <i class="fas fa-hand-holding-dollar fa-2x"></i>
                                    <strong>Deductiva:</strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[3].MontoPenalizacion)
                                </h3>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="row mt-4">
                            <div class="row col-lg-12 mt-3">
                                <div class="col-lg-9 mt-3 ml-4">
                                    <p class="h3 text-justify text-success">El prestador de servicios cumplió con los requisitos mínimos, evitando la deductiva correspondiente.</p>
                                </div>
                                <div class="col-lg-2" style="margin-top: -18px;">
                                    <div class="small-box bg-warning">
                                        <div class="icon">
                                            <i class="fas fa-check-circle text-success"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                <div class="tab-pane fade" id="supervision" role="tabpanel" aria-labelledby="contact-tab">
                    <div class="col-lg-12 h3 mt-4">

                        <h4 style="color: #24135f;">
                            <i class="fas fa-eye me-2"></i><strong> Supervisión del Servicio</strong>
                        </h4>
                    </div>
                    @if (@Model.RespuestasEncuesta[4].Respuesta == false)
                    {
                        <div class="row mt-4">
                            <div class="row col-lg-12 mt-3">
                                <p class="h5 text-justify text-danger ml-3">El prestador de servicios no supervisó la prestación del servicio, siendo acreedor a una deductiva.</p>
                                <div class="col-lg-9 mt-3 ml-4">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Tipo</th>
                                                <th>Fecha de la Incidencia</th>
                                                <th>Comentarios</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var inci in @Model.incidencias.transporte)
                                            {
                                                if (inci.Pregunta.Equals(4 + ""))
                                                {
                                                    <tr>
                                                        <td>@inci.Tipo</td>
                                                        <td>@inci.FechaIncidencia.ToString("dd/MM/yyyy")</td>
                                                        <td>@inci.Comentarios</td>
                                                    </tr>
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-lg-2" style="margin-top: -18px;">
                                    <div class="small-box bg-warning">
                                        <div class="icon">
                                            <i class="fas fa-times-circle text-danger"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-lg-12">
                                <h3 class="text-primary ml-4">
                                    <i class="fas fa-hand-holding-dollar fa-2x"></i>
                                    <strong>Deductiva:</strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[4].MontoPenalizacion)
                                </h3>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="row mt-4">
                            <div class="row col-lg-12 mt-3">
                                <div class="col-lg-9 mt-3 ml-4">
                                    <p class="h3 text-justify text-success">El prestador de servicios supervisó la prestación del servicio, evitando la deductiva correspondiente.</p>
                                </div>
                                <div class="col-lg-2" style="margin-top: -18px;">
                                    <div class="small-box bg-warning">
                                        <div class="icon">
                                            <i class="fas fa-check-circle text-success"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                <div class="tab-pane fade" id="comportamiento" role="tabpanel" aria-labelledby="contact-tab">
                    <div class="col-lg-12 h3 mt-4">

                        <h4 style="color: #24135f;">
                            <i class="fas fa-user-check me-2"></i> <strong>Comportamiento del Personal</strong>
                        </h4>


                    </div>
                    @if (@Model.RespuestasEncuesta[5].Respuesta == false)
                    {
                        <div class="row mt-4">
                            <div class="row col-lg-12 mt-3">
                                <p class="h5 text-justify text-danger ml-3">El prestador de servicios no fue amable, cortés y/o no portó el uniforme con logotipo de la empresa para prestar el servicio, siendo acreedor a una deductiva.</p>
                                <div class="col-lg-9 mt-3 ml-4">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Tipo</th>
                                                <th>Fecha de la Incidencia</th>
                                                <th>Comentarios</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var inci in @Model.incidencias.transporte)
                                            {
                                                if (inci.Pregunta.Equals(6 + ""))
                                                {
                                                    <tr>
                                                        <td>@inci.Tipo</td>
                                                        <td>@inci.FechaIncidencia.ToString("dd/MM/yyyy")</td>
                                                        <td>@inci.Comentarios</td>
                                                    </tr>
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-lg-2" style="margin-top: -18px;">
                                    <div class="small-box bg-warning">
                                        <div class="icon">
                                            <i class="fas fa-times-circle text-danger"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-lg-12">
                                <h3 class="text-primary ml-4">
                                    <i class="fas fa-hand-holding-dollar fa-2x"></i>
                                    <strong>Deductiva:</strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[5].MontoPenalizacion)
                                </h3>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="row mt-4">
                            <div class="row col-lg-12 mt-3">
                                <div class="col-lg-9 mt-3 ml-4">
                                    <p class="h3 text-justify text-success">El prestador de servicios fue amable, cortés y portó el uniforme con logotipo de la empresa para prestar el servicio, evitando la deductiva correspondiente.</p>
                                </div>
                                <div class="col-lg-2" style="margin-top: -18px;">
                                    <div class="small-box bg-warning">
                                        <div class="icon">
                                            <i class="fas fa-check-circle text-success"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
            <div class="tab-pane fade" id="entregables_cedula" role="tabpanel" aria-labelledby="contact-tab">
                <div class="row col-lg-12">
                    <div class="col-lg-8">
                        <h4 style="color: #24135f;">
                            <br>
                            <i class="fas fa-paperclip me-2"></i> <strong>El usuario adjuntó los siguientes entregables:</strong>
                        </h4>
                    </div>
                </div>
                <div class="row col-lg-12 mt-2 h6">
                    <div class="col-lg-12">
                        <table class="table table-hover table-striped table-bordered table-md" width="100%">
                            <thead>
                                <tr>
                                    <th>Tipo</th>
                                    <th>Nombre</th>
                                    <th>Fecha de la Incidencia</th>
                                    <th>Ver</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var entre in @Model.iEntregables)
                                {
                                    <tr>
                                        @if (entre.Tipo.Equals("ActaER"))
                                        {
                                            <td>Acta Entrega - Recepción</td>
                                        }
                                        else if (entre.Tipo.Equals("Factura"))
                                        {
                                            <td>Factura</td>
                                        }
                                        else if (entre.Tipo.Equals("SAT"))
                                        {
                                            <td>Validación del SAT</td>
                                        }
                                        else if (entre.Tipo.Equals("NotaCredito"))
                                        {
                                            <td>Nota de Crédito</td>
                                        }
                                        else if (entre.Tipo.Equals("Reporte(s)"))
                                        {
                                            <td>Reporte(s)</td>
                                        }
                                        else if (entre.Tipo.Equals("Cedula_Firmada"))
                                        {
                                            <td>Cédula Firmada</td>
                                        }
                                        else if (entre.Tipo.Equals("Memorandum"))
                                        {
                                            <td>Memorándum</td>
                                        }
                                        <td>@entre.NombreArchivo</td>
                                        <td>@entre.FechaCreacion.ToString("yyyy-MM-dd")</td>
                                        <td>
                                            <a href='#' class='text-center mr-2 view_file' data-id="@entre.Id" data-file="@entre.NombreArchivo" data-tipo="@entre.Tipo">
                                                <i class='fas fa-eye text-success'></i>
                                            </a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="historial_cedula" role="tabpanel" aria-labelledby="contact-tab">
                <div class="row justify-content-center align-items-center mt-4">
                    <div class="row col-lg-12 mt-2 h6">
                        <h4 style="color: #24135f;">
                            <i class="fas fa-magnifying-glass me-2"></i> <strong>Seguimiento de la Cédula</strong>
                        </h4>

                    </div>
                    <div class="row col-lg-12">
                        <table class="table table-hover table-striped table-bordered table-md" width="100%">
                            <thead>
                                <tr>
                                    <th>Usuario</th>
                                    <th>Comentarios</th>
                                    <th>Estatus</th>
                                    <th>Fecha de Actualización</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var hist in @Model.historialCedulas)
                                {
                                    <tr>
                                        <td>@hist.usuarios.nombre_emp @hist.usuarios.paterno_emp @hist.usuarios.materno_emp</td>
                                        <td>@hist.Comentarios</td>
                                        <td>@hist.Estatus</td>
                                        <td>@Convert.ToDateTime(@hist.FechaCreacion).ToString("dd/MM/yyyy hh:mm tt")</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@* Modal para ver las facturas de la cedula *@
<div class="modal fade" id="modal-ver-facturas">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white">Factura Capturadas</h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-12 mt-3">
                        <table class="table table-responsive" id="listado_facturas">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Empresa</th>
                                    <th>Folio Fiscal</th>
                                    <th>Numero de la Factura</th>
                                    <th>Subtotal de la Factura</th>
                                    <th>Total</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="listaFacturas"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@* FIN del Modal para ver las facturas de la cedula *@

@* Modal para ver los conceptos de las facturas de la cedula *@
<div class="modal fade" id="modal-ver-conceptos">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white" id="factura_serie"></h4>
                <button type="button" class="close close_conceptos text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class=" row col-lg-12" id="detalle_conceptos"></div>
            </div>
        </div>
    </div>
    <!-- /.modal-content -->
</div>
<!-- /.modal-dialog -->
@* Fin de Modal para ver los conceptos de las facturas de la cedula *@

@* Modal para la captura de Adjuntos *@
<div class="modal fade" id="modal_entregablesBD">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white">Adjuntar Entregables</h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <input type="hidden" id="file_id" />
                    <div class="form-group col-lg-6">
                        <label for="elegirArchivo">Seleccionar Archivo: </label>
                        <div class="custom-file">
                            <input type="file" class="custom-file-input" id="customFile" accept=".pdf">
                            <label class="custom-file-label" for="customFile">Seleccionar Archivo</label>
                        </div>
                        <div class="col-sm-12" id="error_customFile">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione él archivo correspondiente
                            </small>
                        </div>
                    </div>
                    <div class="form-group col-lg-3">
                        <div class="fechaEntrega">
                            <label for="forFechaEntrega">Fecha Entrega: </label>
                            <input class="form-control" type="date" id="fecha_entrega" />
                        </div>
                        <div class="col-sm-12" id="error_fechaEntrega">
                            <small id="fechaEntregaHelp" class="text-danger is-valid">
                                Por favor seleccione la fecha de entrega correspondiente
                            </small>
                        </div>
                    </div>
                    <div class="form-group col-lg-3">
                        <div class="fechaLimite">
                            <label for="forFechaLimite">Fecha Límite: </label>
                            <input class="form-control" type="date" id="fecha_limite" />
                        </div>
                        <div class="col-sm-12" id="error_fechaLimite">
                            <small id="fechaLimiteHelp" class="text-danger">
                                Por favor seleccione la fecha límite correspondiente
                            </small>
                        </div>
                    </div>

                    <div class="form-row col-lg-4 mt-2" id="prioridadEntregableBD">
                        <div class="form-group mt-2 col-md-12">
                            <label for="fechaCierre">Prioridad:</label><br>
                            <select class="form-control" id="prioridad_entregable">
                                <option value="">Seleccione la prioridad</option>
                                <option value="1">Normal</option>
                                <option value="2">Urgente</option>
                            </select>
                            <div class="col-sm-12" id="error_prioridad">
                                <small id="comentariosHelp" class="text-danger">
                                    Por favor seleccione la prioridad del entregable
                                </small>
                            </div>
                        </div>
                    </div>

                    <div class="form-row col-lg-12 mt-2" id="comentariosEntregableBD">
                        <div class="form-group mt-2 col-md-12">
                            <label for="fechaCierre">Comentarios:</label><br>
                            <textarea id="comentarios_entregableBD" class="form-control"></textarea>
                            <div class="col-sm-12" id="error_comentariosEntreBD">
                                <small id="comentariosHelp" class="text-danger">
                                    Por favor capture los comentarios correspondientes
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-content-end">
                <button type="button" class="btn btn-primary" id="adjuntarArchivo">Adjuntar Entregable</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@*Fin Modal para la captura de Entregables Bajo Demanda *@

@* Modal para la ver Adjuntos *@
<div class="modal fade" id="show_pdf">
    <div class="modal-dialog modal-xl-view">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white" id="titlePDF"></h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body-view">
                <table class="table">
                    <tr>
                        <td><strong>Folio: </strong> @Model.Folio</td>
                        <td><strong>Año: </strong>@Model.Anio</td>
                        <td><strong>Mes: </strong>@Model.Mes</td>
                        <td><strong>Inmueble: </strong>@Model.inmuebles.Nombre</td>
                        <td><strong>Estatus: </strong>@Model.Estatus </td>
                    </tr>
                </table>
                <div class="row" id="objectPdf">
                </div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@*Fin Modal para ver Adjuntos*@

@* Modal para agregar facturas la cedula *@
<div class="modal fade" id="modal-email">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white">Actualizar Correo Electrónico</h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row col-lg-12 mt-2">
                    <div class=" col-lg-12">
                        <label for="">Correo Electrónico:</label>
                        <input class="form-control" type="email" id="user_email" />
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-content-end">
                <button type="button" class="btn btn-primary" id="update_email">Actualizar Correo</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@* FIN del Modal para agregar facturas la cedula *@

<style>

    /* Asegúrate de que el encabezado también tenga el color o sea compatible */
    .tabla-incidencias-color thead tr {
        background-color: #24135f !important; /* Un tono aún más oscuro para el encabezado */
        color: white !important; /* Texto blanco para el encabezado */
    }
    /* Estilo para CADA contenedor de fila de pestañas (es decir, cada ul.nav-tabs) */
    .nav-tabs {
        display: flex;
        flex-wrap: wrap; /* Permite que las pestañas se envuelvan si hay muchas en una fila */
        border-bottom: 2px solid #ddd; /* Aumentamos el grosor de la línea base para que se vea más sólida */
        margin-bottom: 0; /* Asegura que no haya margen extra debajo de cada fila de pestañas */
    }

    /* Estilo base para CADA ENLACE de pestaña (el <a> con la clase .nav-link1) */
    .nav-link1 {
        font-size: 0.95rem; /* Ligeramente más grande para mejor legibilidad */
        padding: 0.8rem 1.3rem; /* Aumentamos un poco el padding para que las pestañas sean más cómodas */
        color: #555; /* Un gris más suave para el texto inactivo */
        background-color: #f0f0f0; /* Un gris muy claro para el fondo de las inactivas */
        border: 1px solid #ddd; /* Un borde gris claro para todas las pestañas */
        border-bottom: none; /* Crucial: Elimina el borde inferior individual para que se una a la línea del .nav-tabs */
        border-radius: 0.4rem 0.4rem 0 0; /* Bordes superiores un poco más redondeados */
        transition: all 0.3s ease-in-out; /* Transición suave para todos los cambios de estado */
        margin-right: 0.35rem; /* Un poco más de espacio entre pestañas */
        margin-bottom: 0.25rem; /* Mantiene el espacio entre filas cuando se envuelven */
        text-align: center;
        flex-shrink: 0;
        white-space: nowrap;
        min-width: fit-content;
    }

        /* Efecto al pasar el ratón (hover) sobre pestañas inactivas */
        .nav-link1:hover:not(.active) {
            color: #24135f; /* Texto morado principal */
            background-color: #e6e6fa; /* Un lila muy suave para el fondo del hover */
            border-color: #a0a0d0; /* Un borde un poco más oscuro para el hover */
            cursor: pointer;
        }

        /* Estilo para la pestaña ACTIVA */
        .nav-link1.active {
            color: #24135f; /* Texto de la pestaña activa en tu color morado principal */
            background-color: #ffffff; /* Fondo blanco para la pestaña activa */
            border-color: #24135f; /* Borde superior, izquierdo y derecho en morado principal */
            font-weight: 600; /* Texto en negrita para resaltar */
            font-size: 1rem; /* Ligeramente más grande para darle peso visual */
            padding-top: 0.9rem; /* Un poco más de padding para "levantarla" visualmente */
            position: relative;
            z-index: 2; /* Asegura que se muestre por encima de la línea base */
            /* ----- CLAVE para el efecto de remarcado sutil ----- */
            border-bottom: 2px solid #ffffff; /* ¡IMPORTANTE! Este borde inferior "corta" la línea base */
            /* y debe ser del mismo color que el fondo del .tab-content */
            /* para que la pestaña se vea unida al contenido. */
        }

    .border-left-primary {
        border-left: .25rem solid #4e73df !important; /* Color primario de Bootstrap por defecto */
    }

    .text-primary {
        color: #4e73df !important;
    }

    .text-gray-800 {
        color: #5a5c69 !important;
    }

    .text-gray-300 {
        color: #dddfeb !important;
    }

    .text-xs {
        font-size: .7rem;
    }

    .font-weight-bold {
        font-weight: 700 !important;
    }

    .text-uppercase {
        text-transform: uppercase !important;
    }

    /* Ajustes generales para Bootstrap 4/5 para que no-gutters funcione como gx-0 */
    .no-gutters {
        margin-right: 0;
        margin-left: 0;
    }

        .no-gutters > .col,
        .no-gutters > [class*="col-"] {
            padding-right: 0;
            padding-left: 0;
        }

    .titulo-principal {
        font-family: Arial, sans-serif;
        font-size: 25px;
        color: #24135f;
        text-align: left;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        animation: fadeIn 2s ease-in-out;
        font-weight: bold;
        position: relative; /* Agrega esta línea */
        top: -20px; /* Ajusta el valor según sea necesario */
        right: -10px;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

</style>
@section Scripts{
    <script>
        $(function () {
            var model = @Html.Raw(Json.Serialize(@Model));
            $('[data-toggle="tooltip"]').tooltip();

            /*Ver archivo en modal*/
            $(document).on('click', '.view_file', function () {
                let nombre = $(this).data('file');
                let tipo = $(this).data('tipo');
                let data = "<object width='100%' height='710px' data='/view/entregable/" + model.folio + "/" + nombre+"'></object>";
                $('#titlePDF').text("PDF - \"" + tipo + "\"");
                $('#objectPdf').html(data);
                $('#show_pdf').modal('show');
            });
            /*FIN de ver archivo en modal*/

            /*Autorizar Cedula*/
            $(document).on('click', '.success_cedula', function () {
                if (model.usuarios.correo_electronico == "") {
                    Swal.fire({
                        'icon': 'error',
                        'title': 'Servicio de Transporte de Personal',
                        'text': 'No se puede "Aceptar" la cédula ya que aún no se registra un correo electrónico para notificarle al usuario.'
                    });
                } else {
                    Swal.fire({
                        'icon': 'warning',
                        'title': 'Servicio de Transporte de Personal',
                        'html': '¿Esta seguro de que desea <b>Aceptar la cédula con el folio: ' + model.folio + ' ?',
                        'confirmButtonColor': '#3085d6',
                        'cancelButtonColor': '#d33',
                        'confirmButtonText': 'Si, aceptar cédula',
                        'cancelButtonText': 'Cancelar',
                        'showCancelButton': true
                    }).then(confirm => {
                        if (confirm.isConfirmed) {
                            Swal.fire({
                                icon: 'info',
                                'title': 'Servicio de Transporte de Personal',
                                text: 'Por favor captura el motivo por el cual Autorizas la cédula.',
                                showCancelButton: true,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                cancelButtonText: 'Cancelar',
                                confirmButtonText: 'Autorizar',
                                input: 'textarea',
                                inputPlaceholder: 'Escribe los comentarios correspondientes'
                            }).then(send => {
                                if (send.value.length > 0) {
                                    axios.post('/transporte/historialTransporte', {
                                        ServicioId: model.servicioId,
                                        CedulaId: model.id, UsuarioId: parseInt(@User.Claims.ElementAt(0).Value),
                                        Estatus: "Autorizada", Comentarios: send.value
                                    }).then(hist => {
                                        if (hist.status == 200) {
                                            axios.post('/transporte/aprovRechCed', { Id: model.id, Estatus: "Autorizada" }).then(response => {
                                                if (response.status == 200) {
                                                    Swal.fire({
                                                        icon: "info",
                                                        allowOutsideClick: false,
                                                        'title': 'Servicio de Transporte de Personal',
                                                        html: "Autorizando la cédula, por favor espere."
                                                    });
                                                    Swal.showLoading();
                                                    axios.get('/cedula/notificacionCedula/' + model.id).then(notificacion => {
                                                        if (notificacion.status == 200) {
                                                            Swal.hideLoading();
                                                            Swal.fire({
                                                                icon: "success",
                                                                'title': 'Servicio de Transporte de Personal',
                                                                html: "Se autorizó la cédula de evaluación correctamente.",
                                                            }).then(function () {
                                                                window.location.reload();
                                                            });
                                                        }
                                                    });
                                                }
                                            });
                                        }
                                    }).catch(er => {
                                        Swal.fire({
                                            'icon': 'error',
                                            'title': 'Servicio de Transporte de Personal',
                                            'text': 'Ocurrio un error al autorizar la cédula. Contacte al Administrador de Sistema.'
                                        });
                                    });
                                } else {
                                    Swal.fire({
                                        'icon': 'error',
                                        'title': 'Servicio de Fumigación y Fauna Nociva',
                                        'text': 'Capture los comentarios solicitados indicando el motivo por el cual se autoriza la cédula.'
                                    });
                                }
                            });
                        }
                    });
                }
            });
            /*Fin de Autorizar Cedula*/

            /*Rechazar Cedula*/
            $(document).on('click', '.failed_cedula', function () {
                if (model.usuarios.correo_electronico == "") {
                    Swal.fire({
                        'icon': 'error',
                        'title': 'Servicio de Transporte de Personal',
                        'text': 'No se puede "Rechazar" la cédula ya que aún no se registra un correo electrónico para notificarle al usuario.'
                    })
                } else {
                    Swal.fire({
                        'icon': 'warning',
                        'title': 'Servicio de Transporte de Personal',
                        'html': '¿Estas seguro de que deseas <b>Rechazar la cédula con el folio: ' + model.folio + ' ?',
                        'confirmButtonColor': '#3085d6',
                        'cancelButtonColor': '#d33',
                        'confirmButtonText': 'Si, rechazar cédula',
                        'cancelButtonText': 'Cancelar',
                        'showCancelButton': true
                    }).then(confirm => {
                        if (confirm.isConfirmed) {
                            Swal.fire({
                                icon: 'info',
                                'title': 'Servicio de Transporte de Personal',
                                text: 'Por favor captura el motivo por el cual rechazas la cédula.',
                                showCancelButton: true,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                cancelButtonText: 'Cancelar',
                                confirmButtonText: 'Rechazar',
                                input: 'textarea',
                                inputPlaceholder: 'Escribe los comentarios correspondientes'
                            }).then(send => {
                                if (send.value.length > 0) {
                                    axios.post('/transporte/historialTransporte', {
                                        ServicioId: model.servicioId,
                                        CedulaId: model.id, UsuarioId: parseInt(@User.Claims.ElementAt(0).Value),
                                        Estatus: "Rechazada", Comentarios: send.value
                                    }).then(hist => {
                                        if (hist.status == 200) {
                                            axios.post('/transporte/aprovRechCed', { Id: model.id, Estatus: "Rechazada" }).then(response => {
                                                if (response.status == 200) {
                                                    Swal.fire({
                                                        icon: "info",
                                                        allowOutsideClick: false,
                                                        'title': 'Servicio de Transporte de Personal',
                                                        html: "Rechazando la cédula, por favor espere."
                                                    });
                                                    Swal.showLoading();
                                                    axios.get('/cedula/notificacionCedula/' + model.id).then(notificacion => {
                                                        if (notificacion.status == 200) {
                                                            Swal.hideLoading();
                                                            Swal.fire({
                                                                icon: "success",
                                                                'title': 'Servicio de Transporte de Personal',
                                                                html: "Se rechazó la cédula de evaluación correctamente.",
                                                            }).then(function () {
                                                                window.location.reload();
                                                            });
                                                        }
                                                    });
                                                }
                                            });
                                        }
                                    }).catch(er => {
                                        Swal.fire({
                                            'icon': 'error',
                                            'title': 'Servicio de Transporte de Personal',
                                            'text': 'Ocurrio un error al rechazar la cédula. Por favor comunicate a la ext. 2574.'
                                        });
                                    });
                                } else {
                                    Swal.fire({
                                        'icon': 'error',
                                        'title': 'Servicio de Transporte de Personal',
                                        'text': 'Es necesario capturar los comentarios indicando el motivo por el cual se rechaza la cédula.'
                                    });
                                }
                            });
                        }
                    });
                }
            });
            /*Fin de Rechazar Cedula*/

             /*Ver Facturas*/
                $("#btn_facturas").click(function () {
                    axios.get('/limpieza/getFacturas/' + model.id + '/' + model.servicioId).then(table => {
                        var facturas = table.data;
                        for (var i = 0; i < facturas.length; i++) {
                            table += "<tr>" +
                                "<td>" + (i + 1) + "</td>" +
                                "<td>" + facturas[i].tipo + "</td>" +
                                "<td>" + facturas[i].emisor.nombre + "</td>" +
                                "<td>" + facturas[i].timbreFiscal.uuid + "</td>" +
                                "<td>" + (facturas[i].comprobante.serie + "" + facturas[i].comprobante.folio) + "</td>" +
                                "<td> $" + parseFloat(facturas[i].comprobante.subTotal).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') + "</td>" +
                                "<td> $" + parseFloat(facturas[i].comprobante.total).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') + "</td>" +
                                "<td style='font-size: 14px;'>" +
                                    "<a class='view_factura' href='#' data-id='" + i + "'><i class='far fa-list text-success'></i></a>" +
                                    "<a target='_blank' href='/facturas/download/" + facturas[i].id + "/" + facturas[i].tipo + "' class='ml-2' href='#' data-id='" + i + "'><i class='fa-solid fa-download text-danger'></i></a>" +
                                "</td>" +
                                "</tr>";
                        }
                        $("#listaFacturas").html(table);
                        if (facturas.length == 0) {
                            $("#listado_facturas").hide();
                        } else {
                            $("#listado_facturas").show();
                        }
                    });
                    $('#modal-ver-facturas').modal('show');
                });

                $(document).on('click','.view_factura',function () {
                        var id = $(this).data('id');
                        var divTbl = "";
                        $('#modal-ver-facturas').modal('hide');
                        axios.get('/limpieza/getFacturas/' + model.id + '/' + 10).then(table => {
                            $("#factura_serie").text("Detalle de la Factura: " + table.data[id].comprobante.serie + table.data[id].comprobante.folio);
                            var conceptos = table.data[id].concepto;

                            for (var i = 0; i < conceptos.length; i++) {
                                divTbl += '<div class="row col-lg-12 mt-1">' +
                                    '<table class="table table-borderless">' +
                                    '<tr>' +
                                        '<td colspan="4"><strong>Concepto: </strong>' + conceptos[i].descripcion + '</td>'+
                                    '</tr>'+
                                    '<tr>' +
                                    '    <td data-toggle="tooltip" title="Número de elementos que prestaron el servicio en el mes" data-placement="top" id="concepto_cantidad"><strong>Cantidad: </strong>' + table.data[id].concepto[i].cantidad + '</td>' +
                                    '    <td data-toggle="tooltip" title="Clave del Producto o Servicio Facturado" data-placement="top" id="concepto_cveProduc"><strong>Clave del Producto: </strong>' + table.data[id].concepto[i].claveProdServ + '</td>' +
                                    '    <td data-toggle="tooltip" title="Clave de la Medida en Base al Servicio" data-placement="top" id="concepto_medida"><strong>Clave de Medida: </strong>' + table.data[id].concepto[i].claveUnidad + '</td>' +
                                    '    <td data-toggle="tooltip" title="Unidad de Medida" data-placement="top" id="concepto_unidadMed"><strong>Unidad de Medida: </strong>' + table.data[id].concepto[i].unidad + '</td>' +
                                    '    <td data-toggle="tooltip" title="Tipo de CFDI" data-placement="top" id="tipo_cfdi"><strong>Uso de CFDI: </strong>' + table.data[id].receptor.usoCFDI + '</td>' +
                                    '    <td data-toggle="tooltip" title="Valor unitario por unidad" data-placement="top" id="concepto_unitario"><strong>Precio Unitario: </strong> $ ' + (table.data[id].concepto[i].valorUnitario).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') + '</td>' +
                                    '</tr>' +
                                    '<tr>' +
                                    '    <td data-toggle="tooltip" title="IVA del subtotal del 16%" data-placement="top" id="concepto_iva"><strong>IVA: </strong> $ ' + (table.data[id].traslado.importe).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') + '</td>' +
                                    '    <td data-toggle="tooltip" title="Importe total de la facturación" data-placement="top" id="concepto_total"><strong>Total: </strong> $ ' + (table.data[id].concepto[i].importe).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') + '</td>' +
                                    '    <td colspan="3"></td>' +
                                    '</tr>' +
                                    '</table>' +
                                    '</div>';
                            }
                            $("#detalle_conceptos").html(divTbl);
                            $('#modal-ver-conceptos').modal('show');
                        });
                   });
            /*Fin de Ver Facturas*/

            /************** Actualizar Correo Electrónico **********************/
            $("#btn_correo").click(function () {
                    var email = model.usuarios.correo_electronico;
                    $("#user_email").val(email);
                    $("#modal-email").modal("show");
                });

                $("#update_email").click(function () {
                    var email = $("#user_email").val();
                    var user = model.usuarios.id;

                    if(email.indexOf('@String.Format("@")', 0) == -1 || email.indexOf('.', 0) == -1) {
                        Swal.fire({
                            'icon': 'warning',
                            'title': 'Actualización de Correo Electrónico',
                            'html': 'El correo electrónico capturado no es válido. Favor de revisar.'
                        });
                        return false;
                    }

                    axios.post('/usuarios/actualizaEmail', { Id: user, correo_electronico: email }).then(res => {
                        Swal.fire({
                            'icon': 'success',
                            'title': 'Actualización de Correo Electrónico',
                            'html': 'Se actualizó la dirección de correo electrónico del usuario.'
                        }).then(function () {
                            window.location.reload();
                        });
                    });

                });
            /************ Fin Actualizar Correo Electrónico ********************/

        });
    </script>
}


